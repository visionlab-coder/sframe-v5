<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì„œì›í† ê±´ S-FRAME | 2026 ì¸ì‚¬ê³ ê³¼ ì‹œìŠ¤í…œ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0f172a;--surface:#1e293b;--surface2:#273548;--border:#334155;
  --text:#f1f5f9;--text2:#94a3b8;--text3:#64748b;
  --blue:#3b82f6;--blue2:#2563eb;--green:#10b981;--amber:#f59e0b;
  --red:#ef4444;--purple:#8b5cf6;--pink:#ec4899;--cyan:#06b6d4;
  --gold:#f59e0b;--silver:#94a3b8;--bronze:#d97706;
  --sidebar:240px;--header:60px;
}
body{font-family:'Malgun Gothic','Apple SD Gothic Neo',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex}
/* â”€â”€ SIDEBAR â”€â”€ */
#sidebar{width:var(--sidebar);min-height:100vh;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;left:0;top:0;z-index:100;transition:.3s}
.sidebar-logo{padding:20px 16px;border-bottom:1px solid var(--border)}
.sidebar-logo h2{font-size:16px;font-weight:700;color:var(--blue);letter-spacing:.5px}
.sidebar-logo p{font-size:11px;color:var(--text3);margin-top:3px}
.sidebar-nav{flex:1;padding:12px 0;overflow-y:auto}
.nav-section{padding:8px 16px 4px;font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:1px}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 16px;cursor:pointer;transition:.2s;border-radius:0;color:var(--text2);font-size:13px;position:relative}
.nav-item:hover{background:var(--surface2);color:var(--text)}
.nav-item.active{background:rgba(59,130,246,.15);color:var(--blue);border-right:3px solid var(--blue)}
.nav-item .nav-icon{font-size:16px;width:20px;text-align:center}
.nav-badge{background:var(--red);color:#fff;font-size:10px;padding:1px 6px;border-radius:10px;margin-left:auto}
.sidebar-footer{padding:16px;border-top:1px solid var(--border);font-size:11px;color:var(--text3)}
/* â”€â”€ MAIN â”€â”€ */
#main{margin-left:var(--sidebar);flex:1;display:flex;flex-direction:column;min-height:100vh}
#topbar{height:var(--header);background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;gap:16px;position:sticky;top:0;z-index:50}
.topbar-title{font-size:15px;font-weight:600;flex:1}
.topbar-clock{font-size:12px;color:var(--text3);font-family:monospace}
.topbar-btn{background:var(--blue);color:#fff;border:none;padding:6px 14px;border-radius:6px;font-size:12px;cursor:pointer;font-family:inherit}
.topbar-btn:hover{background:var(--blue2)}
.hamburger{display:none;background:none;border:none;color:var(--text);font-size:20px;cursor:pointer}
#content{flex:1;padding:24px;overflow-y:auto}
/* â”€â”€ PAGES â”€â”€ */
.page{display:none}
.page.active{display:block}
/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px}
.card-title{font-size:13px;font-weight:600;color:var(--text2);margin-bottom:16px;display:flex;align-items:center;gap:8px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
/* â”€â”€ STAT CARDS â”€â”€ */
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;display:flex;flex-direction:column;gap:8px}
.stat-label{font-size:12px;color:var(--text3)}
.stat-value{font-size:28px;font-weight:700}
.stat-sub{font-size:11px;color:var(--text3)}
.stat-blue .stat-value{color:var(--blue)}
.stat-green .stat-value{color:var(--green)}
.stat-amber .stat-value{color:var(--amber)}
.stat-red .stat-value{color:var(--red)}
/* â”€â”€ PAGE HEADER â”€â”€ */
.page-header{margin-bottom:24px}
.page-header h1{font-size:22px;font-weight:700}
.page-header p{font-size:13px;color:var(--text3);margin-top:4px}
/* â”€â”€ TABLE â”€â”€ */
.tbl-wrap{overflow-x:auto;border-radius:10px;border:1px solid var(--border)}
table{width:100%;border-collapse:collapse;font-size:13px}
thead tr{background:var(--surface2)}
th{padding:11px 14px;text-align:left;color:var(--text3);font-weight:600;font-size:12px;white-space:nowrap}
td{padding:11px 14px;border-top:1px solid var(--border);color:var(--text2)}
tr:hover td{background:rgba(255,255,255,.02)}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600}
.badge-blue{background:rgba(59,130,246,.15);color:var(--blue)}
.badge-green{background:rgba(16,185,129,.15);color:var(--green)}
.badge-amber{background:rgba(245,158,11,.15);color:var(--amber)}
.badge-red{background:rgba(239,68,68,.15);color:var(--red)}
.badge-purple{background:rgba(139,92,246,.15);color:var(--purple)}
.badge-gray{background:rgba(100,116,139,.15);color:var(--text2)}
/* â”€â”€ BUTTONS â”€â”€ */
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:8px;font-size:13px;font-family:inherit;cursor:pointer;border:none;transition:.2s;font-weight:500}
.btn-primary{background:var(--blue);color:#fff}
.btn-primary:hover{background:var(--blue2)}
.btn-success{background:var(--green);color:#fff}
.btn-success:hover{background:#059669}
.btn-danger{background:var(--red);color:#fff}
.btn-danger:hover{background:#dc2626}
.btn-outline{background:transparent;color:var(--text2);border:1px solid var(--border)}
.btn-outline:hover{border-color:var(--blue);color:var(--blue)}
.btn-sm{padding:5px 10px;font-size:11px}
.btn-gold{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}
.btn-gold:hover{background:linear-gradient(135deg,#d97706,#b45309)}
/* â”€â”€ FORMS â”€â”€ */
.form-group{margin-bottom:14px}
.form-label{display:block;font-size:12px;color:var(--text3);margin-bottom:5px;font-weight:500}
.form-control{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:9px 12px;border-radius:8px;font-size:13px;font-family:inherit}
.form-control:focus{outline:none;border-color:var(--blue)}
.form-control option{background:var(--surface2)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:28px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto}
.modal-wide{max-width:760px}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-header h3{font-size:16px;font-weight:700}
.modal-close{background:none;border:none;color:var(--text3);font-size:20px;cursor:pointer;padding:4px;border-radius:4px}
.modal-close:hover{color:var(--text)}
.modal-footer{display:flex;gap:8px;justify-content:flex-end;margin-top:20px;padding-top:16px;border-top:1px solid var(--border)}
/* â”€â”€ PROGRESS â”€â”€ */
.progress-bar{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;border-radius:4px;transition:width .5s}
.fill-blue{background:var(--blue)}
.fill-green{background:var(--green)}
.fill-amber{background:var(--amber)}
.fill-red{background:var(--red)}
/* â”€â”€ UPLOAD AREA â”€â”€ */
.upload-area{border:2px dashed var(--border);border-radius:12px;padding:40px 20px;text-align:center;cursor:pointer;transition:.2s}
.upload-area:hover,.upload-area.drag{border-color:var(--blue);background:rgba(59,130,246,.05)}
.upload-area .upload-icon{font-size:40px;margin-bottom:12px}
.upload-area p{color:var(--text3);font-size:13px}
.upload-area strong{color:var(--blue)}
/* â”€â”€ FILTER BAR â”€â”€ */
.filter-bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
.filter-bar .form-control{width:auto;min-width:130px}
.search-input{flex:1;min-width:200px;background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:9px 14px;border-radius:8px;font-size:13px;font-family:inherit}
.search-input:focus{outline:none;border-color:var(--blue)}
/* â”€â”€ SITE CARDS â”€â”€ */
.site-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.site-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px;transition:.2s}
.site-card:hover{border-color:var(--blue);transform:translateY(-1px)}
.site-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.site-card-name{font-size:14px;font-weight:600}
.site-card-client{font-size:11px;color:var(--text3);margin-top:2px}
.site-metrics{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:12px 0}
.site-metric{background:var(--surface2);border-radius:8px;padding:8px 10px}
.site-metric-label{font-size:10px;color:var(--text3)}
.site-metric-value{font-size:14px;font-weight:700;margin-top:2px}
.site-card-actions{display:flex;gap:6px;margin-top:12px}
/* â”€â”€ KPI SLIDERS â”€â”€ */
.kpi-slider-wrap{margin-bottom:14px}
.kpi-slider-header{display:flex;justify-content:space-between;margin-bottom:6px}
.kpi-slider-label{font-size:12px;color:var(--text2)}
.kpi-slider-value{font-size:14px;font-weight:700;color:var(--blue)}
input[type=range]{width:100%;-webkit-appearance:none;height:6px;border-radius:3px;background:var(--surface2);cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--blue);cursor:pointer;border:2px solid var(--bg)}
/* â”€â”€ PODIUM â”€â”€ */
.podium{display:flex;align-items:flex-end;justify-content:center;gap:12px;height:180px;margin:24px 0}
.podium-block{display:flex;flex-direction:column;align-items:center;gap:8px;flex:1;max-width:160px}
.podium-avatar{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;margin-bottom:6px}
.podium-name{font-size:12px;font-weight:600;text-align:center}
.podium-dept{font-size:10px;color:var(--text3);text-align:center}
.podium-score{font-size:16px;font-weight:700;margin:4px 0}
.podium-stand{border-radius:8px 8px 0 0;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;width:100%;color:#fff}
.stand-1{background:linear-gradient(135deg,#f59e0b,#d97706);height:120px}
.stand-2{background:linear-gradient(135deg,#94a3b8,#64748b);height:90px}
.stand-3{background:linear-gradient(135deg,#d97706,#b45309);height:70px}
.avatar-gold{background:rgba(245,158,11,.2);border:2px solid var(--gold);color:var(--gold)}
.avatar-silver{background:rgba(148,163,184,.2);border:2px solid var(--silver);color:var(--silver)}
.avatar-bronze{background:rgba(217,119,6,.2);border:2px solid var(--bronze);color:var(--bronze)}
/* â”€â”€ AGENT STATUS â”€â”€ */
.agent-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.agent-card{background:var(--surface2);border-radius:10px;padding:14px;display:flex;align-items:center;gap:12px}
.agent-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.dot-active{background:var(--green);box-shadow:0 0 6px var(--green)}
.dot-idle{background:var(--amber)}
.agent-info{flex:1;min-width:0}
.agent-name{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.agent-status{font-size:10px;color:var(--text3);margin-top:1px}
/* â”€â”€ AWARD CARDS â”€â”€ */
.award-section{margin-bottom:28px}
.award-section-title{font-size:14px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.award-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.award-card{background:var(--surface2);border-radius:12px;padding:16px;text-align:center;border:1px solid var(--border)}
.award-card.gold{border-color:var(--gold);background:rgba(245,158,11,.08)}
.award-card.silver{border-color:var(--silver)}
.award-card.bronze{border-color:var(--bronze)}
.award-emoji{font-size:28px;margin-bottom:8px}
.award-name{font-size:14px;font-weight:700}
.award-dept{font-size:11px;color:var(--text3);margin-top:2px}
.award-score{font-size:20px;font-weight:700;color:var(--blue);margin-top:6px}
/* â”€â”€ SCORE BREAKDOWN â”€â”€ */
.score-breakdown{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.score-item{background:var(--surface);border-radius:6px;padding:4px 8px;font-size:10px;color:var(--text3)}
.score-item span{color:var(--text);font-weight:600}
/* â”€â”€ CHART CONTAINER â”€â”€ */
.chart-container{position:relative;height:260px}
.chart-container-sm{position:relative;height:200px}
/* â”€â”€ TABS â”€â”€ */
.tab-bar{display:flex;gap:4px;margin-bottom:20px;background:var(--surface2);padding:4px;border-radius:10px;flex-wrap:wrap}
.tab-btn{padding:7px 14px;border-radius:7px;font-size:12px;font-weight:500;cursor:pointer;border:none;background:none;color:var(--text3);font-family:inherit;transition:.2s}
.tab-btn.active{background:var(--surface);color:var(--text);box-shadow:0 1px 3px rgba(0,0,0,.3)}
/* â”€â”€ DIVIDER â”€â”€ */
.divider{height:1px;background:var(--border);margin:16px 0}
/* â”€â”€ ALERT â”€â”€ */
.alert{padding:12px 16px;border-radius:8px;font-size:13px;margin-bottom:16px}
.alert-info{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.2);color:#93c5fd}
.alert-success{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);color:#6ee7b7}
.alert-warn{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.2);color:#fcd34d}
/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:900px){
  #sidebar{transform:translateX(-100%)}
  #sidebar.open{transform:translateX(0)}
  #main{margin-left:0}
  .hamburger{display:block}
  .grid-4,.grid-3{grid-template-columns:1fr 1fr}
  .grid-2{grid-template-columns:1fr}
  .form-row{grid-template-columns:1fr}
}
@media(max-width:600px){
  .grid-4,.grid-3,.grid-2{grid-template-columns:1fr}
  #content{padding:16px}
  .podium{height:140px}
  .stand-1{height:90px}.stand-2{height:65px}.stand-3{height:50px}
}
/* â”€â”€ SCROLLBAR â”€â”€ */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
/* â”€â”€ MISC â”€â”€ */
.text-right{text-align:right}
.text-center{text-align:center}
.mt-16{margin-top:16px}
.mb-16{margin-bottom:16px}
.flex{display:flex;align-items:center}
.flex-between{display:flex;justify-content:space-between;align-items:center}
.gap-8{gap:8px}
.gap-12{gap:12px}
.fw-700{font-weight:700}
.text-green{color:var(--green)}
.text-red{color:var(--red)}
.text-amber{color:var(--amber)}
.text-blue{color:var(--blue)}
.text-muted{color:var(--text3)}
.stamp-btn{background:linear-gradient(135deg,#dc2626,#991b1b);color:#fff;border:none;padding:14px 28px;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;width:100%;transition:.2s;box-shadow:0 4px 12px rgba(220,38,38,.3)}
.stamp-btn:hover{transform:scale(1.02);box-shadow:0 6px 20px rgba(220,38,38,.4)}
.stamp-approved{background:linear-gradient(135deg,#059669,#047857);box-shadow:0 4px 12px rgba(5,150,105,.3)}
</style>
</head>
<body>
<!-- SIDEBAR -->
<div id="sidebar">
  <div class="sidebar-logo">
    <h2>ğŸ— S-FRAME V5.0</h2>
    <p>ì„œì›í† ê±´ 2026 ì¸ì‚¬ê³ ê³¼ ì‹œìŠ¤í…œ</p>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section">ë©”ì¸</div>
    <div class="nav-item active" onclick="showPage('dashboard')"><span class="nav-icon">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ</div>
    <div class="nav-section">ì¸ì‚¬ ê´€ë¦¬</div>
    <div class="nav-item" onclick="showPage('staff')"><span class="nav-icon">ğŸ‘¥</span>ì§ì› ì •ë³´ ê´€ë¦¬</div>
    <div class="nav-item" onclick="showPage('site')"><span class="nav-icon">ğŸ—</span>í˜„ì¥ ì •ë³´ ê´€ë¦¬</div>
    <div class="nav-section">í‰ê°€ ì‹œìŠ¤í…œ</div>
    <div class="nav-item" onclick="showPage('kpi')"><span class="nav-icon">ğŸ¯</span>KPI í‰ê°€ ì…ë ¥</div>
    <div class="nav-item" onclick="showPage('multi')"><span class="nav-icon">ğŸ”„</span>ë‹¤ë©´ í‰ê°€</div>
    <div class="nav-item" onclick="showPage('fair')"><span class="nav-icon">âš–ï¸</span>ê³µì •ì„± ë¶„ì„</div>
    <div class="nav-section">ê²°ê³¼ ì‚°ì •</div>
    <div class="nav-item" onclick="showPage('reward')"><span class="nav-icon">ğŸ’°</span>ë³´ìƒ ë“±ê¸‰ ì‚°ì •</div>
    <div class="nav-item" onclick="showPage('awards')"><span class="nav-icon">ğŸ†</span>ì—°ë§ ì‹œìƒì‹</div>
    <div class="nav-section">ê´€ë¦¬</div>
    <div class="nav-item" onclick="showPage('appeal')"><span class="nav-icon">âš ï¸</span>ì´ì˜ì‹ ì²­ <span class="nav-badge" id="appealBadge">2</span></div>
    <div class="nav-item" onclick="showPage('report')"><span class="nav-icon">ğŸ“ˆ</span>ê²½ì˜ì§„ ë³´ê³ ì„œ</div>
    <div class="nav-item" onclick="showPage('setting')"><span class="nav-icon">âš™ï¸</span>ì‹œìŠ¤í…œ ì„¤ì •</div>
  </nav>
  <div class="sidebar-footer">
    <div>2026 í‰ê°€ë…„ë„ | ë§¤ì¶œê¸°ì¤€ 25.10~26.10</div>
    <div style="margin-top:4px">ì§ì› <strong id="sfStaffCount" style="color:var(--blue)">50</strong>ëª… Â· í˜„ì¥ <strong id="sfSiteCount" style="color:var(--green)">10</strong>ê°œ</div>
  </div>
</div>

<!-- MAIN -->
<div id="main">
  <!-- TOPBAR -->
  <div id="topbar">
    <button class="hamburger" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button>
    <div class="topbar-title" id="topbarTitle">ğŸ“Š ëŒ€ì‹œë³´ë“œ</div>
    <div class="topbar-clock" id="clock"></div>
    <button class="topbar-btn" onclick="showPage('awards')">ğŸ† ì‹œìƒì‹</button>
    <button class="topbar-btn stamp-btn" id="topStampBtn" onclick="approveAll()" style="width:auto;padding:6px 14px;font-size:12px;box-shadow:none">ğŸ” ëŒ€í‘œì´ì‚¬ ìŠ¹ì¸</button>
  </div>

  <div id="content">
    <!-- ========== DASHBOARD ========== -->
    <div id="page-dashboard" class="page active">
      <div class="page-header">
        <h1>ğŸ“Š ëŒ€ì‹œë³´ë“œ</h1>
        <p>ì„œì›í† ê±´ 2026 ì¸ì‚¬ê³ ê³¼ Â· ë§¤ì¶œ ê¸°ì¤€: 2025.10 ~ 2026.10</p>
      </div>
      <div class="grid-4 mb-16" id="dashStats"></div>
      <div class="grid-2 mb-16">
        <div class="card">
          <div class="card-title">ğŸ“ˆ ì›”ë³„ KPI ë‹¬ì„±ë¥  ì¶”ì´</div>
          <div class="chart-container"><canvas id="dashKpiChart"></canvas></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ— í˜„ì¥ë³„ ì´ìµë¥ </div>
          <div class="chart-container"><canvas id="dashSiteChart"></canvas></div>
        </div>
      </div>
      <div class="grid-2 mb-16">
        <div class="card">
          <div class="card-title">ğŸ¤– ì—ì´ì „íŠ¸ í™œì„± ìƒíƒœ</div>
          <div class="agent-grid" id="agentGrid"></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ† ë“±ê¸‰ ë¶„í¬</div>
          <div class="chart-container"><canvas id="dashGradeChart"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ— í˜„ì¥ í˜„í™© ìš”ì•½</div>
        <div class="tbl-wrap"><table id="dashSiteTable"><thead><tr><th>í˜„ì¥ëª…</th><th>ë°œì£¼ì²˜</th><th>ë„ê¸‰ê¸ˆì•¡</th><th>ì‹¤í–‰ê¸ˆì•¡</th><th>ì´ìµê¸ˆ</th><th>ì´ìµë¥ </th><th>ê³µì •ë¥ </th><th>í˜„í™©</th></tr></thead><tbody></tbody></table></div>
      </div>
    </div>

    <!-- ========== STAFF ========== -->
    <div id="page-staff" class="page">
      <div class="page-header">
        <h1>ğŸ‘¥ ì§ì› ì •ë³´ ê´€ë¦¬</h1>
        <p>â›” ì§ì› ë“±ë¡ì€ ë°˜ë“œì‹œ Excel íŒŒì¼ ì—…ë¡œë“œë¡œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
      </div>
      <div class="grid-2 mb-16">
        <div class="card">
          <div class="card-title">ğŸ“¤ Excel ì§ì› ì—…ë¡œë“œ</div>
          <div class="upload-area" id="uploadArea" onclick="document.getElementById('xlsxInput').click()" ondragover="dragOver(event)" ondrop="dropFile(event)">
            <div class="upload-icon">ğŸ“‚</div>
            <p><strong>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</strong></p>
            <p style="margin-top:6px">ì§€ì› í˜•ì‹: .xlsx / .xls / .csv</p>
          </div>
          <input type="file" id="xlsxInput" accept=".xlsx,.xls,.csv" style="display:none" onchange="importExcel(this)">
          <div style="margin-top:12px">
            <button class="btn btn-outline btn-sm" onclick="downloadSampleExcel()">ğŸ“¥ ìƒ˜í”Œ Excel ë‹¤ìš´ë¡œë“œ</button>
          </div>
        </div>
        <div class="card" id="colMapCard" style="display:none">
          <div class="card-title">ğŸ—‚ ì»¬ëŸ¼ ë§¤í•‘</div>
          <div id="colMapBody"></div>
          <div style="margin-top:14px">
            <button class="btn btn-primary" onclick="applyMapping()">âœ… ì ìš©í•˜ê¸°</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="flex-between mb-16">
          <div class="card-title" style="margin-bottom:0">ğŸ‘¤ ì§ì› ëª©ë¡ (<span id="staffCountLabel">0</span>ëª…)</div>
          <div class="filter-bar" style="margin-bottom:0">
            <input class="search-input" id="staffSearch" placeholder="ì´ë¦„ ê²€ìƒ‰..." oninput="renderStaffTable()" style="width:160px">
            <select class="form-control" id="staffDeptFilter" onchange="renderStaffTable()"><option value="">ì „ì²´ ë¶€ì„œ</option></select>
            <select class="form-control" id="staffRankFilter" onchange="renderStaffTable()"><option value="">ì „ì²´ ì§ê¸‰</option></select>
          </div>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>No</th><th>ì´ë¦„</th><th>ë¶€ì„œ</th><th>ì§ê¸‰</th><th>ì…ì‚¬ì¼</th><th>í˜„ì¥</th><th>KPIì ìˆ˜</th><th>ì—­ëŸ‰ì ìˆ˜</th><th>ì´ì </th><th>ë“±ê¸‰</th></tr></thead>
            <tbody id="staffTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ========== SITE ========== -->
    <div id="page-site" class="page">
      <div class="page-header">
        <h1>ğŸ— í˜„ì¥ ì •ë³´ ê´€ë¦¬</h1>
        <p>ìˆ˜ì£¼ì”ê³ , ë„ê¸‰ê¸ˆì•¡, ì‹¤í–‰ê¸ˆì•¡, ì´ìµë¥  ë° ê³µì‚¬ ì§„í–‰ í˜„í™© ê´€ë¦¬</p>
      </div>
      <div class="flex-between mb-16">
        <div class="filter-bar" style="margin-bottom:0">
          <input class="search-input" id="siteSearch" placeholder="í˜„ì¥ëª… ê²€ìƒ‰..." oninput="renderSiteTable()" style="width:180px">
          <select class="form-control" id="siteStatusFilter" onchange="renderSiteTable()">
            <option value="">ì „ì²´ í˜„í™©</option><option value="ì •ìƒ">ì •ìƒì§„í–‰</option><option value="ì§€ì—°">ê³µì •ì§€ì—°</option><option value="ì´ˆê³¼">ì˜ˆì‚°ì´ˆê³¼</option><option value="ì‚¬ê³ ">ì•ˆì „ì‚¬ê³ </option><option value="ì™„ë£Œ">ì™„ë£Œ</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="openSiteModal(null)">â• í˜„ì¥ ì¶”ê°€</button>
      </div>
      <div class="card mb-16">
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>í˜„ì¥ëª…</th><th>ë°œì£¼ì²˜</th><th>í˜„ì¥ì†Œì¥</th><th>ë„ê¸‰ê¸ˆì•¡(ì–µ)</th><th>ì‹¤í–‰ê¸ˆì•¡(ì–µ)</th><th>ì´ìµê¸ˆ(ì–µ)</th><th>ì´ìµë¥ </th><th>ê³µì •ë¥ </th><th>í˜„í™©</th><th>ê¸°ê°„</th><th>ê´€ë¦¬</th></tr></thead>
            <tbody id="siteTableBody"></tbody>
          </table>
        </div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ“Š í˜„ì¥ë³„ ì´ìµë¥ </div>
          <div class="chart-container"><canvas id="siteBarChart"></canvas></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“ˆ ì›”ë³„ ë§¤ì¶œ ì§‘ê³„</div>
          <div class="chart-container"><canvas id="siteRevenueChart"></canvas></div>
        </div>
      </div>
    </div>

    <!-- ========== KPI ========== -->
    <div id="page-kpi" class="page">
      <div class="page-header">
        <h1>ğŸ¯ KPI í‰ê°€ ì…ë ¥</h1>
        <p>ì§ê¸‰ë³„ ë¶€í•˜ì§ì› KPI ì§ì ‘ ì…ë ¥ Â· 5ê°œ í•­ëª© í‰ê°€</p>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ‘¤ í‰ê°€ì ì„ íƒ</div>
          <div class="form-group">
            <label class="form-label">í‰ê°€ì ì§ê¸‰</label>
            <select class="form-control" id="evalRankSel" onchange="loadEvalSubordinates()">
              <option value="">-- ì§ê¸‰ ì„ íƒ --</option>
              <option value="ëŒ€í‘œì´ì‚¬">ëŒ€í‘œì´ì‚¬</option>
              <option value="ì‚¬ì¥">ì‚¬ì¥</option>
              <option value="ì „ë¬´">ì „ë¬´</option>
              <option value="ìƒë¬´">ìƒë¬´</option>
              <option value="ì´ì‚¬">ì´ì‚¬</option>
              <option value="íŒ€ì¥">íŒ€ì¥(ì‹¤ì¥)</option>
              <option value="ë¶€ì¥">ë¶€ì¥</option>
              <option value="ì°¨ì¥">ì°¨ì¥</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">í‰ê°€ì ì´ë¦„</label>
            <select class="form-control" id="evalNameSel" onchange="loadEvalSubordinates()"><option value="">-- ì´ë¦„ ì„ íƒ --</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">í‰ê°€ ëŒ€ìƒ ì§ì›</label>
            <select class="form-control" id="evalTargetSel" onchange="loadKpiInputs()"><option value="">-- ì§ì› ì„ íƒ --</option></select>
          </div>
        </div>
        <div class="card" id="kpiInputCard">
          <div class="card-title">ğŸ“ KPI í•­ëª© ì…ë ¥</div>
          <div id="kpiInputBody">
            <div class="alert alert-info">ì¢Œì¸¡ì—ì„œ í‰ê°€ìì™€ í‰ê°€ ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”</div>
          </div>
        </div>
      </div>
      <div class="card mt-16">
        <div class="card-title">ğŸ“Š KPI ì…ë ¥ í˜„í™©</div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>ì´ë¦„</th><th>ë¶€ì„œ</th><th>ì§ê¸‰</th><th>ëª©í‘œë‹¬ì„±</th><th>í’ˆì§ˆ</th><th>ì•ˆì „</th><th>í˜‘ì—…</th><th>ê¸°ì—¬</th><th>KPIí•©ê³„</th><th>ìƒíƒœ</th></tr></thead>
            <tbody id="kpiStatusBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ========== MULTI ========== -->
    <div id="page-multi" class="page">
      <div class="page-header">
        <h1>ğŸ”„ ë‹¤ë©´ í‰ê°€</h1>
        <p>ë™ë£Œ í‰ê°€ Â· ë¶€í•˜ í‰ê°€ Â· ì—­ëŸ‰ í‰ê°€ (360ë„)</p>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ‘¤ ë™ë£Œ í‰ê°€ ì…ë ¥</div>
          <div class="form-group">
            <label class="form-label">í‰ê°€ì</label>
            <select class="form-control" id="peerEvalSel"><option value="">-- ì„ íƒ --</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">í”¼í‰ê°€ì</label>
            <select class="form-control" id="peerTargetSel"><option value="">-- ì„ íƒ --</option></select>
          </div>
          <div class="divider"></div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">ğŸ’¼ ì—…ë¬´ ì—­ëŸ‰</span><span class="kpi-slider-value" id="slPeer1">70</span></div>
            <input type="range" min="0" max="100" value="70" id="sPeer1" oninput="document.getElementById('slPeer1').textContent=this.value">
          </div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">ğŸ¤ í˜‘ì—… ëŠ¥ë ¥</span><span class="kpi-slider-value" id="slPeer2">75</span></div>
            <input type="range" min="0" max="100" value="75" id="sPeer2" oninput="document.getElementById('slPeer2').textContent=this.value">
          </div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">ğŸ’¡ ì°½ì˜ì„±</span><span class="kpi-slider-value" id="slPeer3">65</span></div>
            <input type="range" min="0" max="100" value="65" id="sPeer3" oninput="document.getElementById('slPeer3').textContent=this.value">
          </div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">ğŸ¯ ë¦¬ë”ì‹­</span><span class="kpi-slider-value" id="slPeer4">70</span></div>
            <input type="range" min="0" max="100" value="70" id="sPeer4" oninput="document.getElementById('slPeer4').textContent=this.value">
          </div>
          <button class="btn btn-primary" style="width:100%;margin-top:8px" onclick="savePeerEval()">ì €ì¥</button>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“Š ì—­ëŸ‰ ë ˆì´ë” ì°¨íŠ¸</div>
          <div class="chart-container"><canvas id="multiRadarChart"></canvas></div>
          <div style="text-align:center;margin-top:12px" id="multiTargetName"><span class="text-muted">ì§ì›ì„ ì„ íƒí•˜ë©´ ì—­ëŸ‰ ì°¨íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤</span></div>
        </div>
      </div>
      <div class="card mt-16">
        <div class="card-title">ğŸ“‹ ë™ë£Œ í‰ê°€ í˜„í™©</div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>ì´ë¦„</th><th>ë¶€ì„œ</th><th>ì§ê¸‰</th><th>ì—…ë¬´ì—­ëŸ‰</th><th>í˜‘ì—…</th><th>ì°½ì˜ì„±</th><th>ë¦¬ë”ì‹­</th><th>í‰ê· </th><th>ìƒíƒœ</th></tr></thead>
            <tbody id="multiStatusBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ========== FAIR ========== -->
    <div id="page-fair" class="page">
      <div class="page-header">
        <h1>âš–ï¸ ê³µì •ì„± ë¶„ì„</h1>
        <p>AI ì˜´ë¶€ì¦ˆë§¨ Â· í¸í–¥ íƒì§€ Â· ìº˜ë¦¬ë¸Œë ˆì´ì…˜</p>
      </div>
      <div class="grid-4 mb-16" id="fairStats"></div>
      <div class="grid-2 mb-16">
        <div class="card">
          <div class="card-title">ğŸ” Z-Score í¸í–¥ ë¶„ì„</div>
          <div class="chart-container"><canvas id="fairZChart"></canvas></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ¢ ë¶€ì„œë³„ í‰ê·  ì ìˆ˜ ë¶„í¬</div>
          <div class="chart-container"><canvas id="fairDeptChart"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ¤– AI í¸í–¥ íƒì§€ ê²°ê³¼</div>
        <div id="fairAlerts"></div>
      </div>
    </div>

    <!-- ========== REWARD ========== -->
    <div id="page-reward" class="page">
      <div class="page-header">
        <h1>ğŸ’° ë³´ìƒ ë“±ê¸‰ ì‚°ì •</h1>
        <p>Triple-Mix ë°©ì‹ Â· KPI 40% + ì—­ëŸ‰ 30% + ë™ë£Œí‰ê°€ 20% + ì„±ì‹¤ë„ 10%</p>
      </div>
      <div class="grid-2 mb-16">
        <div class="card">
          <div class="card-title">âš–ï¸ ê°€ì¤‘ì¹˜ ì„¤ì •</div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">KPI ë‹¬ì„±ë¥ </span><span class="kpi-slider-value" id="wKpi">40</span>%</div>
            <input type="range" min="0" max="100" value="40" id="sWKpi" oninput="document.getElementById('wKpi').textContent=this.value;calcReward()">
          </div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">ì—­ëŸ‰ ì ìˆ˜</span><span class="kpi-slider-value" id="wComp">30</span>%</div>
            <input type="range" min="0" max="100" value="30" id="sWComp" oninput="document.getElementById('wComp').textContent=this.value;calcReward()">
          </div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">ë™ë£Œ í‰ê°€</span><span class="kpi-slider-value" id="wPeer">20</span>%</div>
            <input type="range" min="0" max="100" value="20" id="sWPeer" oninput="document.getElementById('wPeer').textContent=this.value;calcReward()">
          </div>
          <div class="kpi-slider-wrap">
            <div class="kpi-slider-header"><span class="kpi-slider-label">ì„±ì‹¤ë„</span><span class="kpi-slider-value" id="wDili">10</span>%</div>
            <input type="range" min="0" max="100" value="10" id="sWDili" oninput="document.getElementById('wDili').textContent=this.value;calcReward()">
          </div>
          <button class="btn btn-primary" style="width:100%;margin-top:8px" onclick="calcReward()">ğŸ”„ ì¬ê³„ì‚°</button>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“Š ë“±ê¸‰ ë¶„í¬</div>
          <div class="chart-container"><canvas id="rewardDonut"></canvas></div>
          <div id="rewardGradeSummary" style="margin-top:12px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap"></div>
        </div>
      </div>
      <div class="card">
        <div class="flex-between mb-16">
          <div class="card-title" style="margin-bottom:0">ğŸ“‹ ì§ì›ë³„ ìµœì¢… ë“±ê¸‰</div>
          <button class="btn btn-gold" onclick="approveReward()">ğŸ” ëŒ€í‘œì´ì‚¬ ìŠ¹ì¸</button>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ë¶€ì„œ</th><th>ì§ê¸‰</th><th>KPI</th><th>ì—­ëŸ‰</th><th>ë™ë£Œ</th><th>ì„±ì‹¤ë„</th><th>ìµœì¢…ì ìˆ˜</th><th>ë“±ê¸‰</th></tr></thead>
            <tbody id="rewardTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ========== AWARDS ========== -->
    <div id="page-awards" class="page">
      <div class="page-header">
        <h1>ğŸ† ì—°ë§ ì‹œìƒì‹ 2026</h1>
        <p>ì„œì›í† ê±´ ìš°ìˆ˜ ì§ì›Â·í˜„ì¥ ì‹œìƒ Â· ì „ì²´ ì ìˆ˜ ê¸°ë°˜ ìë™ ì‚°ì •</p>
      </div>
      <div class="flex-between mb-16">
        <div></div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-primary" onclick="calcAwards()">ğŸ¯ ìˆ˜ìƒì ìë™ ì‚°ì •</button>
          <button class="btn btn-gold" onclick="approveAwards()">ğŸ” ëŒ€í‘œì´ì‚¬ ê²°ì¬</button>
        </div>
      </div>
      <div id="awardsBody">
        <div class="alert alert-info">ìƒë‹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìˆ˜ìƒìë¥¼ ìë™ ì‚°ì •í•˜ì„¸ìš”</div>
      </div>
    </div>

    <!-- ========== APPEAL ========== -->
    <div id="page-appeal" class="page">
      <div class="page-header">
        <h1>âš ï¸ ì´ì˜ì‹ ì²­ ì„¼í„°</h1>
        <p>í‰ê°€ ê²°ê³¼ì— ì´ì˜ê°€ ìˆì„ ê²½ìš° ì‹ ì²­ ê°€ëŠ¥ Â· AI ê²€í†  í›„ HRíŒ€ í™•ì¸</p>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ“ ì´ì˜ì‹ ì²­ ì ‘ìˆ˜</div>
          <div class="form-group">
            <label class="form-label">ì‹ ì²­ì</label>
            <select class="form-control" id="appealStaffSel"><option value="">-- ì§ì› ì„ íƒ --</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">ì‹ ì²­ ìœ í˜•</label>
            <select class="form-control" id="appealType">
              <option>KPI ì ìˆ˜ ì˜¤ë¥˜</option><option>ì—­ëŸ‰ í‰ê°€ ë¶€ë‹¹</option><option>ë™ë£Œ í‰ê°€ í¸í–¥</option><option>ë“±ê¸‰ ì‚°ì • ì˜¤ë¥˜</option><option>ê¸°íƒ€</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ì‹ ì²­ ë‚´ìš©</label>
            <textarea class="form-control" id="appealContent" rows="4" placeholder="êµ¬ì²´ì ì¸ ì‚¬ìœ ë¥¼ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
          </div>
          <button class="btn btn-primary" style="width:100%" onclick="submitAppeal()">ì´ì˜ì‹ ì²­ ì œì¶œ</button>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“‹ ì´ì˜ì‹ ì²­ í˜„í™©</div>
          <div id="appealList"></div>
        </div>
      </div>
    </div>

    <!-- ========== REPORT ========== -->
    <div id="page-report" class="page">
      <div class="page-header">
        <h1>ğŸ“ˆ ê²½ì˜ì§„ ë³´ê³ ì„œ</h1>
        <p>2026 ì¸ì‚¬ê³ ê³¼ ì¢…í•© ë¶„ì„ ë³´ê³ ì„œ</p>
      </div>
      <div class="grid-4 mb-16" id="reportStats"></div>
      <div class="grid-2 mb-16">
        <div class="card">
          <div class="card-title">ğŸ“Š ë¶€ì„œë³„ í‰ê·  KPI</div>
          <div class="chart-container"><canvas id="reportDeptKpi"></canvas></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ— í˜„ì¥ ì„±ê³¼ ìˆœìœ„</div>
          <div class="chart-container"><canvas id="reportSitePerf"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ” ì§ê¸‰ë³„ í‰ê°€ ë¶„í¬</div>
        <div class="chart-container-sm"><canvas id="reportRankChart"></canvas></div>
      </div>
    </div>

    <!-- ========== SETTING ========== -->
    <div id="page-setting" class="page">
      <div class="page-header">
        <h1>âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</h1>
        <p>S-FRAME 2026 ì„¤ì • ê´€ë¦¬</p>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ“… í‰ê°€ ì¼ì •</div>
          <table style="width:100%;font-size:13px">
            <tr><td style="padding:8px 0;color:var(--text3)">ëª©í‘œ ì„¤ì •</td><td style="padding:8px 0;font-weight:600">2026.01.02 ~ 01.31</td></tr>
            <tr style="border-top:1px solid var(--border)"><td style="padding:8px 0;color:var(--text3)">ë¶„ê¸°ë³„ ë™ë£Œ í‰ê°€</td><td style="padding:8px 0;font-weight:600">3/6/9/11ì›”</td></tr>
            <tr style="border-top:1px solid var(--border)"><td style="padding:8px 0;color:var(--text3)">KPI ìº˜ë¦¬ë¸Œë ˆì´ì…˜</td><td style="padding:8px 0;font-weight:600">2026.11.01 ~ 11.30</td></tr>
            <tr style="border-top:1px solid var(--border)"><td style="padding:8px 0;color:var(--text3)">ìµœì¢… ë³´ìƒ ì‚°ì •</td><td style="padding:8px 0;font-weight:600">2026.12.01 ~ 12.15</td></tr>
            <tr style="border-top:1px solid var(--border)"><td style="padding:8px 0;color:var(--text3)">ì—°ë§ ì‹œìƒì‹</td><td style="padding:8px 0;font-weight:600">2026.12.20</td></tr>
          </table>
        </div>
        <div class="card">
          <div class="card-title">âš™ï¸ í‰ê°€ ê°€ì¤‘ì¹˜ (ê¸°ë³¸ê°’)</div>
          <table style="width:100%;font-size:13px">
            <tr><td style="padding:8px 0;color:var(--text3)">KPI ë‹¬ì„±ë¥ </td><td style="padding:8px 0;font-weight:600;color:var(--blue)">40%</td></tr>
            <tr style="border-top:1px solid var(--border)"><td style="padding:8px 0;color:var(--text3)">ì—­ëŸ‰ ì ìˆ˜</td><td style="padding:8px 0;font-weight:600;color:var(--green)">30%</td></tr>
            <tr style="border-top:1px solid var(--border)"><td style="padding:8px 0;color:var(--text3)">ë™ë£Œ í‰ê°€</td><td style="padding:8px 0;font-weight:600;color:var(--amber)">20%</td></tr>
            <tr style="border-top:1px solid var(--border)"><td style="padding:8px 0;color:var(--text3)">ì„±ì‹¤ë„</td><td style="padding:8px 0;font-weight:600;color:var(--purple)">10%</td></tr>
          </table>
        </div>
        <div class="card">
          <div class="card-title">ğŸ¢ ë“±ë¡ ë¶€ì„œ</div>
          <div id="deptList" style="display:flex;gap:6px;flex-wrap:wrap"></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn btn-outline" onclick="exportAllData()">ğŸ“¤ ì „ì²´ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn btn-outline" onclick="resetToDemo()">ğŸ”„ ë°ëª¨ ë°ì´í„° ì´ˆê¸°í™”</button>
            <button class="btn btn-danger btn-sm" onclick="if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆê¹Œ?')){localStorage.clear();location.reload()}">âš ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
          </div>
        </div>
      </div>
    </div>
  </div><!-- /content -->
</div><!-- /main -->

<!-- ========== SITE MODAL ========== -->
<div class="modal-overlay" id="siteModal">
  <div class="modal modal-wide">
    <div class="modal-header">
      <h3 id="siteModalTitle">í˜„ì¥ ì •ë³´</h3>
      <button class="modal-close" onclick="closeModal('siteModal')">âœ•</button>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">í˜„ì¥ëª… *</label><input class="form-control" id="mSiteName" placeholder="ì˜ˆ: í™”ì„±ë™íƒ„2 ìì´"></div>
      <div class="form-group"><label class="form-label">ë°œì£¼ì²˜ *</label><input class="form-control" id="mSiteClient" placeholder="ì˜ˆ: GSê±´ì„¤"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">í˜„ì¥ì†Œì¥</label><input class="form-control" id="mSiteMgr" placeholder="ë‹´ë‹¹ì ì´ë¦„"></div>
      <div class="form-group"><label class="form-label">ìœ„ì¹˜</label><input class="form-control" id="mSiteLoc" placeholder="ì˜ˆ: ê²½ê¸°ë„ í™”ì„±ì‹œ"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">ë„ê¸‰ê³„ì•½ê¸ˆì•¡ (ì–µì›) *</label><input class="form-control" type="number" id="mSiteContract" placeholder="0" oninput="calcProfit()"></div>
      <div class="form-group"><label class="form-label">ì‹¤í–‰ê¸ˆì•¡ (ì–µì›)</label><input class="form-control" type="number" id="mSiteExec" placeholder="0" oninput="calcProfit()"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">ì´ìµê¸ˆ (ì–µì›)</label><input class="form-control" id="mSiteProfit" readonly style="background:rgba(16,185,129,.08);color:var(--green)"></div>
      <div class="form-group"><label class="form-label">ì´ìµë¥  (%)</label><input class="form-control" id="mSiteProfitRate" readonly style="background:rgba(16,185,129,.08);color:var(--green)"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">ê³µì‚¬ ê¸°ê°„</label><input class="form-control" id="mSitePeriod" placeholder="ì˜ˆ: 2024.03 ~ 2026.12"></div>
      <div class="form-group">
        <label class="form-label">ê³µì •ë¥  (%)</label>
        <input class="form-control" type="number" id="mSiteProgress" min="0" max="100" placeholder="0">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ê³µì‚¬ í˜„í™©</label>
        <select class="form-control" id="mSiteStatus">
          <option value="ì •ìƒ">âœ… ì •ìƒì§„í–‰</option><option value="ì§€ì—°">âš ï¸ ê³µì •ì§€ì—°</option><option value="ì´ˆê³¼">ğŸ”´ ì˜ˆì‚°ì´ˆê³¼</option><option value="ì‚¬ê³ ">ğŸš¨ ì•ˆì „ì‚¬ê³ </option><option value="ì™„ë£Œ">ğŸ ì™„ë£Œ</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">ì•ˆì „ ì ìˆ˜</label>
        <input class="form-control" type="number" id="mSiteSafety" min="0" max="100" placeholder="0~100">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">ë¹„ê³ /íŠ¹ì´ì‚¬í•­</label>
      <textarea class="form-control" id="mSiteNote" rows="2" placeholder="ê³µì‚¬ í˜„í™© íŠ¹ì´ì‚¬í•­..."></textarea>
    </div>
    <input type="hidden" id="mSiteId">
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('siteModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="saveSite()">ğŸ’¾ ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ========== STAMP MODAL ========== -->
<div class="modal-overlay" id="stampModal">
  <div class="modal" style="max-width:400px;text-align:center">
    <div style="font-size:48px;margin-bottom:16px">ğŸ”</div>
    <h3 style="font-size:18px;margin-bottom:8px" id="stampTitle">ëŒ€í‘œì´ì‚¬ ìµœì¢… ìŠ¹ì¸</h3>
    <p style="color:var(--text3);font-size:13px;margin-bottom:20px" id="stampDesc">2026 ì„œì›í† ê±´ ì¸ì‚¬ê³ ê³¼ ê²°ê³¼ë¥¼ ìµœì¢… ìŠ¹ì¸í•©ë‹ˆë‹¤</p>
    <button class="stamp-btn" id="stampExecBtn" onclick="execStamp()">âœ… ì´ìƒí›ˆ ëŒ€í‘œì´ì‚¬ ìŠ¹ì¸</button>
    <div id="stampResult" style="display:none;margin-top:16px;padding:12px;background:rgba(16,185,129,.1);border-radius:8px;color:var(--green);font-weight:600">
      âœ… 2026.12.20 ìŠ¹ì¸ ì™„ë£Œ
    </div>
    <button class="btn btn-outline" style="width:100%;margin-top:12px" onclick="closeModal('stampModal')">ë‹«ê¸°</button>
  </div>
</div>
<script>
// ============================================================
//  S-FRAME V5.0 â€” ì„œì›í† ê±´ 2026 ì¸ì‚¬ê³ ê³¼ ì‹œìŠ¤í…œ
// ============================================================

// â”€â”€ 1. DEMO DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEPTS = ['ì¬ë¬´ê´€ë¦¬ì‹¤','ê²½ì˜ì§€ì›ì‹¤','êµ¬ë§¤ê´€ë¦¬ì‹¤','ê¸°ìˆ ì§€ì›ë³¸ë¶€','ì•ˆì „í™˜ê²½ì‹¤','ì›ê°€ê´€ë¦¬ì‹¤','ë¯¸ë˜ì „ëµTFíŒ€'];
const RANKS = ['ëŒ€í‘œì´ì‚¬','ì‚¬ì¥','ì „ë¬´','ìƒë¬´','ì´ì‚¬','íŒ€ì¥','ë¶€ì¥','ì°¨ì¥','ê³¼ì¥','ëŒ€ë¦¬','ì‚¬ì›'];
const RANK_ORDER = {ëŒ€í‘œì´ì‚¬:0,ì‚¬ì¥:1,ì „ë¬´:2,ìƒë¬´:3,ì´ì‚¬:4,íŒ€ì¥:5,ë¶€ì¥:6,ì°¨ì¥:7,ê³¼ì¥:8,ëŒ€ë¦¬:9,ì‚¬ì›:10};

const DEMO_SITES = [
  {id:'s01',name:'ì•„ì‚°íƒ•ì • í…Œí¬ë…¸ë°¸ë¦¬',client:'ì‚¼ì„±ì „ì',mgr:'ê¹€íƒœë¯¼',loc:'ì¶©ë‚¨ ì•„ì‚°ì‹œ',contract:850,exec:740,period:'2023.09~2026.08',progress:73,safety:92,status:'ì •ìƒ',note:'',rev:[58,62,70,75,68,72,80,85,78,82,88,90,92]},
  {id:'s02',name:'ê³ ì–‘ì‚¼ì†¡ eí¸í•œì„¸ìƒ',client:'ëŒ€ë¦¼ì‚°ì—…',mgr:'ì´ìˆ˜ì§„',loc:'ê²½ê¸° ê³ ì–‘ì‹œ',contract:420,exec:380,period:'2024.03~2026.12',progress:45,safety:88,status:'ì •ìƒ',note:'',rev:[28,30,35,38,32,36,40,42,38,40,44,46,48]},
  {id:'s03',name:'ì›ì£¼ë¬´ì‹¤ ìì´',client:'GSê±´ì„¤',mgr:'ë°•ì°¬í˜¸',loc:'ê°•ì› ì›ì£¼ì‹œ',contract:380,exec:345,period:'2023.06~2026.06',progress:88,safety:95,status:'ì •ìƒ',note:'',rev:[22,25,28,30,26,28,32,35,30,32,36,38,40]},
  {id:'s04',name:'í”„ë ˆìŠ¤í‹°ì–´ìì´ ê²½ê¸°',client:'GSê±´ì„¤',mgr:'ìµœì§€ì€',loc:'ê²½ê¸° ìˆ˜ì›ì‹œ',contract:920,exec:890,period:'2024.01~2027.06',progress:62,safety:85,status:'ì§€ì—°',note:'ì² ê·¼ ìˆ˜ê¸‰ ë¬¸ì œë¡œ 1ê°œì›” ì§€ì—°',rev:[60,65,72,78,68,74,82,88,80,85,92,96,100]},
  {id:'s05',name:'ìš¸ì‚°ì‹ ì •ë™ ì£¼ë³µ',client:'ë¡¯ë°ê±´ì„¤',mgr:'ì •ì„±í›ˆ',loc:'ìš¸ì‚°ê´‘ì—­ì‹œ',contract:560,exec:490,period:'2024.06~2027.03',progress:34,safety:78,status:'ì •ìƒ',note:'',rev:[35,38,42,45,40,43,48,52,46,50,55,58,62]},
  {id:'s06',name:'ì²­ì£¼í…Œí¬ë…¸ ëŒ€ìš°',client:'ëŒ€ìš°ê±´ì„¤',mgr:'í™ë¯¸ë˜',loc:'ì¶©ë¶ ì²­ì£¼ì‹œ',contract:290,exec:275,period:'2023.03~2026.03',progress:91,safety:97,status:'ì •ìƒ',note:'',rev:[18,20,22,24,21,23,26,28,25,27,30,32,34]},
  {id:'s07',name:'í™”ì„±ë™íƒ„2',client:'í˜„ëŒ€ê±´ì„¤',mgr:'ì¥í˜„ìš°',loc:'ê²½ê¸° í™”ì„±ì‹œ',contract:1100,exec:1050,period:'2023.12~2027.12',progress:55,safety:90,status:'ì´ˆê³¼',note:'ì„¤ê³„ ë³€ê²½ìœ¼ë¡œ ì‹¤í–‰ê¸ˆì•¡ ì¦ê°€',rev:[72,78,85,90,82,88,96,102,94,100,108,112,118]},
  {id:'s08',name:'ë‚¨ì–‘ì£¼ì§„ì ‘',client:'í¬ìŠ¤ì½”ê±´ì„¤',mgr:'ìœ¤ë¯¸ì •',loc:'ê²½ê¸° ë‚¨ì–‘ì£¼ì‹œ',contract:340,exec:310,period:'2024.04~2026.09',progress:78,safety:93,status:'ì •ìƒ',note:'',rev:[20,22,25,28,24,26,30,32,28,30,34,36,38]},
  {id:'s09',name:'ë¶€ì‚°ì—ì½”1ì°¨',client:'ì—ì½”ê±´ì„¤',mgr:'ê°•ì¤€ì„',loc:'ë¶€ì‚°ê´‘ì—­ì‹œ',contract:210,exec:195,period:'2023.01~2026.01',progress:95,safety:99,status:'ì™„ë£Œ',note:'ë¬´ì‚¬ê³  ì™„ê³µ ì˜ˆì •',rev:[12,14,16,18,15,17,20,22,19,21,24,25,26]},
  {id:'s10',name:'í‰íƒë¸Œë ˆì¸ì‹œí‹°',client:'SKê±´ì„¤',mgr:'ì„ì§€í˜œ',loc:'ê²½ê¸° í‰íƒì‹œ',contract:680,exec:720,period:'2024.09~2028.03',progress:41,safety:82,status:'ì‚¬ê³ ',note:'2026.02 ê²½ë¯¸í•œ ì•ˆì „ì‚¬ê³  ë°œìƒ, ì¡°ì¹˜ ì™„ë£Œ',rev:[42,45,50,55,48,52,58,62,56,60,66,70,74]}
];

const DEMO_STAFF = [
  // ëŒ€í‘œì´ì‚¬
  {id:'e01',name:'ì´ìƒí›ˆ',dept:'ë³¸ì‚¬',rank:'ëŒ€í‘œì´ì‚¬',joined:'2010-01-01',site:'',kpi:{ëª©í‘œë‹¬ì„±:95,í’ˆì§ˆ:92,ì•ˆì „:96,í˜‘ì—…:94,ê¸°ì—¬:93},competency:93,peer:92,diligence:96,score:0,grade:''},
  // ì‚¬ì¥
  {id:'e02',name:'ë°•ì •ìš°',dept:'ë³¸ì‚¬',rank:'ì‚¬ì¥',joined:'2012-03-15',site:'',kpi:{ëª©í‘œë‹¬ì„±:90,í’ˆì§ˆ:88,ì•ˆì „:92,í˜‘ì—…:89,ê¸°ì—¬:91},competency:89,peer:88,diligence:92,score:0,grade:''},
  // ì „ë¬´
  {id:'e03',name:'ê¹€ì² ìˆ˜',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ì „ë¬´',joined:'2013-05-20',site:'',kpi:{ëª©í‘œë‹¬ì„±:87,í’ˆì§ˆ:85,ì•ˆì „:90,í˜‘ì—…:86,ê¸°ì—¬:88},competency:86,peer:85,diligence:89,score:0,grade:''},
  {id:'e04',name:'ìµœì˜í¬',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'ì „ë¬´',joined:'2014-02-10',site:'',kpi:{ëª©í‘œë‹¬ì„±:85,í’ˆì§ˆ:87,ì•ˆì „:88,í˜‘ì—…:90,ê¸°ì—¬:86},competency:87,peer:88,diligence:87,score:0,grade:''},
  // ìƒë¬´
  {id:'e05',name:'ì •ë¯¼ì„',dept:'ì¬ë¬´ê´€ë¦¬ì‹¤',rank:'ìƒë¬´',joined:'2015-07-01',site:'',kpi:{ëª©í‘œë‹¬ì„±:84,í’ˆì§ˆ:82,ì•ˆì „:86,í˜‘ì—…:83,ê¸°ì—¬:85},competency:83,peer:82,diligence:86,score:0,grade:''},
  {id:'e06',name:'ìœ¤ì„±í˜¸',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'ìƒë¬´',joined:'2015-09-15',site:'',kpi:{ëª©í‘œë‹¬ì„±:88,í’ˆì§ˆ:86,ì•ˆì „:94,í˜‘ì—…:85,ê¸°ì—¬:87},competency:87,peer:86,diligence:90,score:0,grade:''},
  {id:'e07',name:'í•œì§€ìˆ˜',dept:'ì›ê°€ê´€ë¦¬ì‹¤',rank:'ìƒë¬´',joined:'2016-01-10',site:'',kpi:{ëª©í‘œë‹¬ì„±:82,í’ˆì§ˆ:84,ì•ˆì „:85,í˜‘ì—…:88,ê¸°ì—¬:83},competency:84,peer:85,diligence:84,score:0,grade:''},
  // ì´ì‚¬
  {id:'e08',name:'ì˜¤ì¤€í˜',dept:'êµ¬ë§¤ê´€ë¦¬ì‹¤',rank:'ì´ì‚¬',joined:'2016-06-01',site:'',kpi:{ëª©í‘œë‹¬ì„±:80,í’ˆì§ˆ:78,ì•ˆì „:82,í˜‘ì—…:81,ê¸°ì—¬:80},competency:80,peer:79,diligence:82,score:0,grade:''},
  {id:'e09',name:'ì‹ ì§€ì˜',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ì´ì‚¬',joined:'2017-03-20',site:'',kpi:{ëª©í‘œë‹¬ì„±:82,í’ˆì§ˆ:84,ì•ˆì „:83,í˜‘ì—…:80,ê¸°ì—¬:81},competency:82,peer:81,diligence:83,score:0,grade:''},
  {id:'e10',name:'ë°°ì„±ë¯¼',dept:'ë¯¸ë˜ì „ëµTFíŒ€',rank:'ì´ì‚¬',joined:'2017-08-05',site:'',kpi:{ëª©í‘œë‹¬ì„±:85,í’ˆì§ˆ:80,ì•ˆì „:81,í˜‘ì—…:87,ê¸°ì—¬:86},competency:84,peer:85,diligence:82,score:0,grade:''},
  {id:'e11',name:'ë¥˜í˜„ì•„',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'ì´ì‚¬',joined:'2018-01-15',site:'',kpi:{ëª©í‘œë‹¬ì„±:78,í’ˆì§ˆ:82,ì•ˆì „:80,í˜‘ì—…:83,ê¸°ì—¬:79},competency:81,peer:82,diligence:80,score:0,grade:''},
  {id:'e12',name:'ë°•íƒœì–‘',dept:'ì¬ë¬´ê´€ë¦¬ì‹¤',rank:'ì´ì‚¬',joined:'2018-04-10',site:'',kpi:{ëª©í‘œë‹¬ì„±:76,í’ˆì§ˆ:78,ì•ˆì „:79,í˜‘ì—…:77,ê¸°ì—¬:80},competency:78,peer:77,diligence:79,score:0,grade:''},
  {id:'e13',name:'ê°•í˜œì§„',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'ì´ì‚¬',joined:'2018-09-01',site:'',kpi:{ëª©í‘œë‹¬ì„±:83,í’ˆì§ˆ:79,ì•ˆì „:92,í˜‘ì—…:80,ê¸°ì—¬:82},competency:83,peer:80,diligence:85,score:0,grade:''},
  // íŒ€ì¥ (10ëª…)
  {id:'e14',name:'ê°•ë™í›ˆ',dept:'ì¬ë¬´ê´€ë¦¬ì‹¤',rank:'íŒ€ì¥',joined:'2019-01-07',site:'',kpi:{ëª©í‘œë‹¬ì„±:75,í’ˆì§ˆ:74,ì•ˆì „:76,í˜‘ì—…:78,ê¸°ì—¬:75},competency:75,peer:74,diligence:77,score:0,grade:''},
  {id:'e15',name:'ì„ì„ ì˜',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'íŒ€ì¥',joined:'2019-03-15',site:'',kpi:{ëª©í‘œë‹¬ì„±:77,í’ˆì§ˆ:76,ì•ˆì „:75,í˜‘ì—…:80,ê¸°ì—¬:74},competency:76,peer:77,diligence:76,score:0,grade:''},
  {id:'e16',name:'í™ê¸°ì² ',dept:'êµ¬ë§¤ê´€ë¦¬ì‹¤',rank:'íŒ€ì¥',joined:'2019-06-20',site:'',kpi:{ëª©í‘œë‹¬ì„±:72,í’ˆì§ˆ:75,ì•ˆì „:73,í˜‘ì—…:74,ê¸°ì—¬:76},competency:74,peer:73,diligence:74,score:0,grade:''},
  {id:'e17',name:'ì„œì¤€í˜¸',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'íŒ€ì¥',joined:'2020-01-06',site:'',kpi:{ëª©í‘œë‹¬ì„±:79,í’ˆì§ˆ:80,ì•ˆì „:78,í˜‘ì—…:76,ê¸°ì—¬:77},competency:78,peer:79,diligence:78,score:0,grade:''},
  {id:'e18',name:'ê¶Œë¯¼ì§€',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'íŒ€ì¥',joined:'2020-04-13',site:'',kpi:{ëª©í‘œë‹¬ì„±:80,í’ˆì§ˆ:76,ì•ˆì „:90,í˜‘ì—…:78,ê¸°ì—¬:79},competency:80,peer:78,diligence:82,score:0,grade:''},
  {id:'e19',name:'ë¬¸ì¬ì›',dept:'ì›ê°€ê´€ë¦¬ì‹¤',rank:'íŒ€ì¥',joined:'2020-07-01',site:'',kpi:{ëª©í‘œë‹¬ì„±:73,í’ˆì§ˆ:77,ì•ˆì „:74,í˜‘ì—…:75,ê¸°ì—¬:72},competency:74,peer:75,diligence:74,score:0,grade:''},
  {id:'e20',name:'ì¥í˜œì§„',dept:'ë¯¸ë˜ì „ëµTFíŒ€',rank:'íŒ€ì¥',joined:'2021-01-04',site:'',kpi:{ëª©í‘œë‹¬ì„±:82,í’ˆì§ˆ:78,ì•ˆì „:76,í˜‘ì—…:85,ê¸°ì—¬:83},competency:81,peer:82,diligence:79,score:0,grade:''},
  {id:'e21',name:'ë°±ìŠ¹ìš°',dept:'ì¬ë¬´ê´€ë¦¬ì‹¤',rank:'íŒ€ì¥',joined:'2021-03-22',site:'',kpi:{ëª©í‘œë‹¬ì„±:70,í’ˆì§ˆ:72,ì•ˆì „:71,í˜‘ì—…:73,ê¸°ì—¬:70},competency:71,peer:70,diligence:72,score:0,grade:''},
  {id:'e22',name:'ì¡°ì˜ˆë¦°',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'íŒ€ì¥',joined:'2021-06-14',site:'',kpi:{ëª©í‘œë‹¬ì„±:74,í’ˆì§ˆ:76,ì•ˆì „:72,í˜‘ì—…:78,ê¸°ì—¬:75},competency:75,peer:76,diligence:74,score:0,grade:''},
  {id:'e23',name:'ë‚¨ê¶ì§„',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'íŒ€ì¥',joined:'2021-08-30',site:'',kpi:{ëª©í‘œë‹¬ì„±:76,í’ˆì§ˆ:78,ì•ˆì „:75,í˜‘ì—…:74,ê¸°ì—¬:77},competency:76,peer:75,diligence:77,score:0,grade:''},
  // ì¼ë°˜ ì§ì› (27ëª…)
  {id:'e24',name:'ê¹€ë¯¼ì¤€',dept:'ì¬ë¬´ê´€ë¦¬ì‹¤',rank:'ë¶€ì¥',joined:'2020-02-17',site:'',kpi:{ëª©í‘œë‹¬ì„±:68,í’ˆì§ˆ:70,ì•ˆì „:69,í˜‘ì—…:72,ê¸°ì—¬:67},competency:69,peer:70,diligence:70,score:0,grade:''},
  {id:'e25',name:'ì´ì„œì—°',dept:'ì¬ë¬´ê´€ë¦¬ì‹¤',rank:'ëŒ€ë¦¬',joined:'2022-01-03',site:'',kpi:{ëª©í‘œë‹¬ì„±:65,í’ˆì§ˆ:66,ì•ˆì „:64,í˜‘ì—…:68,ê¸°ì—¬:63},competency:65,peer:66,diligence:66,score:0,grade:''},
  {id:'e26',name:'ë°•ì§€í›ˆ',dept:'ì¬ë¬´ê´€ë¦¬ì‹¤',rank:'ì‚¬ì›',joined:'2024-02-26',site:'',kpi:{ëª©í‘œë‹¬ì„±:62,í’ˆì§ˆ:60,ì•ˆì „:63,í˜‘ì—…:65,ê¸°ì—¬:60},competency:62,peer:61,diligence:63,score:0,grade:''},
  {id:'e27',name:'ìµœìˆ˜ì•„',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'ë¶€ì¥',joined:'2019-09-02',site:'',kpi:{ëª©í‘œë‹¬ì„±:72,í’ˆì§ˆ:74,ì•ˆì „:70,í˜‘ì—…:76,ê¸°ì—¬:71},competency:73,peer:74,diligence:72,score:0,grade:''},
  {id:'e28',name:'ì •íƒœìš°',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'ëŒ€ë¦¬',joined:'2022-03-07',site:'',kpi:{ëª©í‘œë‹¬ì„±:67,í’ˆì§ˆ:65,ì•ˆì „:66,í˜‘ì—…:70,ê¸°ì—¬:65},competency:67,peer:66,diligence:67,score:0,grade:''},
  {id:'e29',name:'ìœ¤ë‹¤ì€',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'ì‚¬ì›',joined:'2024-01-02',site:'',kpi:{ëª©í‘œë‹¬ì„±:60,í’ˆì§ˆ:62,ì•ˆì „:61,í˜‘ì—…:64,ê¸°ì—¬:59},competency:61,peer:62,diligence:62,score:0,grade:''},
  {id:'e30',name:'ì„í˜„ìŠ¹',dept:'êµ¬ë§¤ê´€ë¦¬ì‹¤',rank:'ì°¨ì¥',joined:'2020-05-11',site:'',kpi:{ëª©í‘œë‹¬ì„±:70,í’ˆì§ˆ:68,ì•ˆì „:71,í˜‘ì—…:69,ê¸°ì—¬:72},competency:70,peer:69,diligence:71,score:0,grade:''},
  {id:'e31',name:'ì˜¤ë¯¸ë‚˜',dept:'êµ¬ë§¤ê´€ë¦¬ì‹¤',rank:'ëŒ€ë¦¬',joined:'2022-07-04',site:'',kpi:{ëª©í‘œë‹¬ì„±:64,í’ˆì§ˆ:66,ì•ˆì „:63,í˜‘ì—…:67,ê¸°ì—¬:62},competency:64,peer:65,diligence:65,score:0,grade:''},
  {id:'e32',name:'í•œì†Œí¬',dept:'êµ¬ë§¤ê´€ë¦¬ì‹¤',rank:'ì‚¬ì›',joined:'2023-02-13',site:'',kpi:{ëª©í‘œë‹¬ì„±:61,í’ˆì§ˆ:59,ì•ˆì „:62,í˜‘ì—…:63,ê¸°ì—¬:58},competency:61,peer:60,diligence:62,score:0,grade:''},
  {id:'e33',name:'ì‹ ë™í˜„',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ì°¨ì¥',joined:'2019-11-25',site:'',kpi:{ëª©í‘œë‹¬ì„±:74,í’ˆì§ˆ:76,ì•ˆì „:73,í˜‘ì—…:72,ê¸°ì—¬:75},competency:74,peer:73,diligence:75,score:0,grade:''},
  {id:'e34',name:'ë°°ì§€ì€',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ëŒ€ë¦¬',joined:'2021-09-06',site:'',kpi:{ëª©í‘œë‹¬ì„±:68,í’ˆì§ˆ:70,ì•ˆì „:67,í˜‘ì—…:71,ê¸°ì—¬:66},competency:68,peer:69,diligence:69,score:0,grade:''},
  {id:'e35',name:'ì „ë¯¼í˜¸',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ì‚¬ì›',joined:'2023-07-03',site:'',kpi:{ëª©í‘œë‹¬ì„±:63,í’ˆì§ˆ:61,ì•ˆì „:64,í˜‘ì—…:65,ê¸°ì—¬:60},competency:63,peer:62,diligence:64,score:0,grade:''},
  {id:'e36',name:'ë¥˜ì„¸ì§„',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ì‚¬ì›',joined:'2024-07-01',site:'',kpi:{ëª©í‘œë‹¬ì„±:58,í’ˆì§ˆ:60,ì•ˆì „:59,í˜‘ì—…:62,ê¸°ì—¬:57},competency:59,peer:60,diligence:60,score:0,grade:''},
  {id:'e37',name:'ì¥ì •í›ˆ',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'ë¶€ì¥',joined:'2020-08-17',site:'',kpi:{ëª©í‘œë‹¬ì„±:75,í’ˆì§ˆ:71,ì•ˆì „:88,í˜‘ì—…:73,ê¸°ì—¬:74},competency:76,peer:74,diligence:78,score:0,grade:''},
  {id:'e38',name:'ê¹€ë‚˜ì˜',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'ëŒ€ë¦¬',joined:'2022-05-09',site:'',kpi:{ëª©í‘œë‹¬ì„±:66,í’ˆì§ˆ:64,ì•ˆì „:78,í˜‘ì—…:68,ê¸°ì—¬:65},competency:68,peer:66,diligence:70,score:0,grade:''},
  {id:'e39',name:'ì´ì¤€í˜',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'ì‚¬ì›',joined:'2023-09-04',site:'',kpi:{ëª©í‘œë‹¬ì„±:62,í’ˆì§ˆ:60,ì•ˆì „:72,í˜‘ì—…:64,ê¸°ì—¬:61},competency:64,peer:62,diligence:65,score:0,grade:''},
  {id:'e40',name:'ë°•í˜„ì§„',dept:'ì›ê°€ê´€ë¦¬ì‹¤',rank:'ì°¨ì¥',joined:'2019-12-02',site:'',kpi:{ëª©í‘œë‹¬ì„±:71,í’ˆì§ˆ:73,ì•ˆì „:70,í˜‘ì—…:72,ê¸°ì—¬:71},competency:71,peer:72,diligence:72,score:0,grade:''},
  {id:'e41',name:'ìµœë¯¼ì¬',dept:'ì›ê°€ê´€ë¦¬ì‹¤',rank:'ëŒ€ë¦¬',joined:'2022-09-05',site:'',kpi:{ëª©í‘œë‹¬ì„±:65,í’ˆì§ˆ:67,ì•ˆì „:64,í˜‘ì—…:68,ê¸°ì—¬:63},competency:65,peer:66,diligence:66,score:0,grade:''},
  {id:'e42',name:'ì •ìœ ì§„',dept:'ì›ê°€ê´€ë¦¬ì‹¤',rank:'ì‚¬ì›',joined:'2024-03-04',site:'',kpi:{ëª©í‘œë‹¬ì„±:60,í’ˆì§ˆ:62,ì•ˆì „:61,í˜‘ì—…:63,ê¸°ì—¬:58},competency:60,peer:61,diligence:62,score:0,grade:''},
  {id:'e43',name:'ìœ¤ì¬í˜„',dept:'ë¯¸ë˜ì „ëµTFíŒ€',rank:'ë¶€ì¥',joined:'2021-01-11',site:'',kpi:{ëª©í‘œë‹¬ì„±:78,í’ˆì§ˆ:75,ì•ˆì „:74,í˜‘ì—…:82,ê¸°ì—¬:80},competency:78,peer:79,diligence:77,score:0,grade:''},
  {id:'e44',name:'í•œì¬ë¯¼',dept:'ë¯¸ë˜ì „ëµTFíŒ€',rank:'ëŒ€ë¦¬',joined:'2022-11-07',site:'',kpi:{ëª©í‘œë‹¬ì„±:70,í’ˆì§ˆ:68,ì•ˆì „:67,í˜‘ì—…:74,ê¸°ì—¬:72},competency:70,peer:71,diligence:70,score:0,grade:''},
  // í˜„ì¥ ì§ì› (6ëª…)
  {id:'e45',name:'ê¹€ì„±ë¯¼',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ì°¨ì¥',joined:'2020-06-15',site:'ì•„ì‚°íƒ•ì • í…Œí¬ë…¸ë°¸ë¦¬',kpi:{ëª©í‘œë‹¬ì„±:76,í’ˆì§ˆ:78,ì•ˆì „:82,í˜‘ì—…:74,ê¸°ì—¬:77},competency:77,peer:76,diligence:79,score:0,grade:''},
  {id:'e46',name:'ì´ì§€ì›',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'ëŒ€ë¦¬',joined:'2022-04-04',site:'í™”ì„±ë™íƒ„2',kpi:{ëª©í‘œë‹¬ì„±:68,í’ˆì§ˆ:65,ì•ˆì „:85,í˜‘ì—…:70,ê¸°ì—¬:66},competency:70,peer:68,diligence:72,score:0,grade:''},
  {id:'e47',name:'ë°•ìˆ˜ë¯¼',dept:'ì›ê°€ê´€ë¦¬ì‹¤',rank:'ì°¨ì¥',joined:'2019-08-26',site:'í”„ë ˆìŠ¤í‹°ì–´ìì´ ê²½ê¸°',kpi:{ëª©í‘œë‹¬ì„±:73,í’ˆì§ˆ:72,ì•ˆì „:75,í˜‘ì—…:71,ê¸°ì—¬:74},competency:73,peer:72,diligence:74,score:0,grade:''},
  {id:'e48',name:'ìµœì¬ì›',dept:'ê¸°ìˆ ì§€ì›ë³¸ë¶€',rank:'ëŒ€ë¦¬',joined:'2021-11-22',site:'í‰íƒë¸Œë ˆì¸ì‹œí‹°',kpi:{ëª©í‘œë‹¬ì„±:66,í’ˆì§ˆ:68,ì•ˆì „:70,í˜‘ì—…:67,ê¸°ì—¬:65},competency:67,peer:66,diligence:68,score:0,grade:''},
  {id:'e49',name:'ì •ë¯¼ì•„',dept:'ê²½ì˜ì§€ì›ì‹¤',rank:'ì‚¬ì›',joined:'2023-04-03',site:'ê³ ì–‘ì‚¼ì†¡ eí¸í•œì„¸ìƒ',kpi:{ëª©í‘œë‹¬ì„±:61,í’ˆì§ˆ:63,ì•ˆì „:64,í˜‘ì—…:65,ê¸°ì—¬:60},competency:62,peer:63,diligence:63,score:0,grade:''},
  {id:'e50',name:'ìœ¤ì„±ì°¬',dept:'ì•ˆì „í™˜ê²½ì‹¤',rank:'ë¶€ì¥',joined:'2020-10-05',site:'ë¶€ì‚°ì—ì½”1ì°¨',kpi:{ëª©í‘œë‹¬ì„±:80,í’ˆì§ˆ:76,ì•ˆì „:95,í˜‘ì—…:78,ê¸°ì—¬:79},competency:81,peer:79,diligence:83,score:0,grade:''},
];

const AGENTS = [
  {name:'ë§ˆìŠ¤í„° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°',status:'active',desc:'ì „ì²´ ì‹œìŠ¤í…œ ì¡°ìœ¨'},
  {name:'KPI íŠ¸ë˜ì»¤',status:'active',desc:'ì‹¤ì‹œê°„ KPI ìˆ˜ì§‘'},
  {name:'ê³µì •ì„± ê°ì‹œ AI',status:'active',desc:'í¸í–¥ íƒì§€ ì¤‘'},
  {name:'ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì—ì´ì „íŠ¸',status:'active',desc:'ì ìˆ˜ ì¡°ì • ì™„ë£Œ'},
  {name:'ì½”ì¹­ ì—ì´ì „íŠ¸',status:'active',desc:'ìœ¡ì„± ê³„íš ìˆ˜ë¦½'},
  {name:'ë³´ìƒ ì‚°ì • AI',status:'active',desc:'ë“±ê¸‰ ê³„ì‚° ì¤‘'},
  {name:'Excel ë°ì´í„° íŒŒì´í”„ë¼ì¸',status:'idle',desc:'ëŒ€ê¸° ì¤‘'},
  {name:'ë§¤ì¶œ íŠ¸ë˜ì»¤',status:'active',desc:'í˜„ì¥ ë§¤ì¶œ ì§‘ê³„'},
  {name:'ì´ì˜ì‹ ì²­ ì²˜ë¦¬ AI',status:'idle',desc:'2ê±´ ê²€í†  ëŒ€ê¸°'},
  {name:'ì•ˆì „ ëª¨ë‹ˆí„°ë§',status:'active',desc:'IoT ì„¼ì„œ 247ê°œ'},
  {name:'HR ì˜´ë¶€ì¦ˆë§¨',status:'active',desc:'ê³µì •ì„± 92.4%'},
  {name:'ê²½ì˜ ë³´ê³ ì„œ AI',status:'idle',desc:'ë³´ê³ ì„œ ìƒì„± ëŒ€ê¸°'},
];

const APPEALS = [
  {id:'ap01',name:'í™ê¸°ì² ',dept:'êµ¬ë§¤ê´€ë¦¬ì‹¤',type:'KPI ì ìˆ˜ ì˜¤ë¥˜',content:'ëª©í‘œë‹¬ì„± ì ìˆ˜ê°€ ì‹¤ì œë³´ë‹¤ ë‚®ê²Œ ê¸°ì…ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤.',status:'ê²€í† ì¤‘',date:'2026-12-02'},
  {id:'ap02',name:'ì´ì§€ì›',dept:'ì•ˆì „í™˜ê²½ì‹¤',type:'ë™ë£Œ í‰ê°€ í¸í–¥',content:'íŠ¹ì • í‰ê°€ìì˜ í¸í–¥ëœ ì ìˆ˜ê°€ ë°˜ì˜ëœ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.',status:'ì ‘ìˆ˜',date:'2026-12-05'},
];

// â”€â”€ 2. STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  sites: JSON.parse(JSON.stringify(DEMO_SITES)),
  staff: JSON.parse(JSON.stringify(DEMO_STAFF)),
  appeals: JSON.parse(JSON.stringify(APPEALS)),
  xlsxRaw: null,
  xlsxHeaders: [],
  colMap: {},
};

function saveState(){try{localStorage.setItem('sf_state',JSON.stringify({sites:state.sites,staff:state.staff,appeals:state.appeals}));}catch(e){}}
function loadState(){
  try{
    const s=JSON.parse(localStorage.getItem('sf_state'));
    if(s&&s.staff&&s.staff.length){
      state.sites=s.sites;state.staff=s.staff;state.appeals=s.appeals;
    }
  }catch(e){}
  calcAllScores();
}

// â”€â”€ 3. SCORE CALCULATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcKpiScore(emp){
  const v=Object.values(emp.kpi);
  return Math.round(v.reduce((a,b)=>a+b,0)/v.length);
}
function getGrade(s){
  if(s>=90)return'S';if(s>=80)return'A';if(s>=70)return'B';if(s>=60)return'C';return'D';
}
function getGradeBadge(g){
  const c={S:'purple',A:'blue',B:'green',C:'amber',D:'red'};
  return `<span class="badge badge-${c[g]||'gray'}">${g}</span>`;
}
function calcAllScores(){
  state.staff.forEach(e=>{
    const kpi=calcKpiScore(e);
    const w1=parseInt(document.getElementById('sWKpi')?.value||40)/100;
    const w2=parseInt(document.getElementById('sWComp')?.value||30)/100;
    const w3=parseInt(document.getElementById('sWPeer')?.value||20)/100;
    const w4=parseInt(document.getElementById('sWDili')?.value||10)/100;
    e.score=Math.round(kpi*w1+e.competency*w2+e.peer*w3+e.diligence*w4);
    e.grade=getGrade(e.score);
  });
}

// â”€â”€ 4. NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PAGE_TITLES={'dashboard':'ğŸ“Š ëŒ€ì‹œë³´ë“œ','staff':'ğŸ‘¥ ì§ì› ì •ë³´ ê´€ë¦¬','site':'ğŸ— í˜„ì¥ ì •ë³´ ê´€ë¦¬','kpi':'ğŸ¯ KPI í‰ê°€ ì…ë ¥','multi':'ğŸ”„ ë‹¤ë©´ í‰ê°€','fair':'âš–ï¸ ê³µì •ì„± ë¶„ì„','reward':'ğŸ’° ë³´ìƒ ë“±ê¸‰ ì‚°ì •','awards':'ğŸ† ì—°ë§ ì‹œìƒì‹','appeal':'âš ï¸ ì´ì˜ì‹ ì²­','report':'ğŸ“ˆ ê²½ì˜ì§„ ë³´ê³ ì„œ','setting':'âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •'};
let charts={};

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const pg=document.getElementById('page-'+id);
  if(pg)pg.classList.add('active');
  const ni=[...document.querySelectorAll('.nav-item')].find(n=>n.getAttribute('onclick')&&n.getAttribute('onclick').includes("'"+id+"'"));
  if(ni)ni.classList.add('active');
  document.getElementById('topbarTitle').textContent=PAGE_TITLES[id]||id;
  // Close sidebar on mobile
  document.getElementById('sidebar').classList.remove('open');
  // Render page
  const fn={dashboard:renderDashboard,staff:renderStaffTable,site:renderSiteTable,kpi:renderKpiPage,multi:renderMultiPage,fair:renderFairPage,reward:renderRewardPage,awards:()=>{},appeal:renderAppealPage,report:renderReportPage,setting:renderSettingPage};
  if(fn[id])fn[id]();
}

// â”€â”€ 5. CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateClock(){
  const now=new Date();
  const s=`${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
  document.getElementById('clock').textContent=s;
}

// â”€â”€ 6. CHART HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function destroyChart(id){if(charts[id]){charts[id].destroy();delete charts[id];}}
const CHART_DEFAULTS={color:'rgba(241,245,249,0.85)',grid:'rgba(51,65,85,0.5)'};
function chartColors(n){
  const base=['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6','#06b6d4','#ec4899','#f97316','#14b8a6','#6366f1'];
  const arr=[];for(let i=0;i<n;i++)arr.push(base[i%base.length]);return arr;
}

// â”€â”€ 7. DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDashboard(){
  calcAllScores();
  // Stats
  const totalRev=state.sites.reduce((a,s)=>a+s.rev[s.rev.length-1],0);
  const avgScore=Math.round(state.staff.reduce((a,e)=>a+e.score,0)/state.staff.length);
  const accidentSites=state.sites.filter(s=>s.status==='ì‚¬ê³ ').length;
  const avgProgress=Math.round(state.sites.reduce((a,s)=>a+s.progress,0)/state.sites.length);
  document.getElementById('dashStats').innerHTML=`
    <div class="stat-card stat-blue"><div class="stat-label">ğŸ‘¥ ì´ ì§ì›</div><div class="stat-value">${state.staff.length}ëª…</div><div class="stat-sub">7ê°œ ë¶€ì„œ + í˜„ì¥</div></div>
    <div class="stat-card stat-green"><div class="stat-label">ğŸ— ê´€ë¦¬ í˜„ì¥</div><div class="stat-value">${state.sites.length}ê°œ</div><div class="stat-sub">í‰ê·  ê³µì •ë¥  ${avgProgress}%</div></div>
    <div class="stat-card stat-amber"><div class="stat-label">ğŸ“Š ì „ì‚¬ í‰ê·  KPI</div><div class="stat-value">${avgScore}ì </div><div class="stat-sub">ëª©í‘œ 80ì  ëŒ€ë¹„</div></div>
    <div class="stat-card stat-${accidentSites>0?'red':'blue'}"><div class="stat-label">ğŸ¦º ì•ˆì „ í˜„í™©</div><div class="stat-value">${accidentSites===0?'ë¬´ì‚¬ê³ ':'ì‚¬ê³ '+accidentSites+'ê±´'}</div><div class="stat-sub">IoT 247ê°œ ëª¨ë‹ˆí„°ë§</div></div>`;
  // Sidebar counts
  document.getElementById('sfStaffCount').textContent=state.staff.length;
  document.getElementById('sfSiteCount').textContent=state.sites.length;
  // KPI trend chart
  destroyChart('dashKpi');
  const months=['25.10','25.11','25.12','26.01','26.02','26.03','26.04','26.05','26.06','26.07','26.08','26.09','26.10'];
  const kpiTrend=[72,74,75,76,75,77,78,79,78,80,81,82,83];
  charts['dashKpi']=new Chart(document.getElementById('dashKpiChart'),{type:'line',data:{labels:months,datasets:[{label:'ì „ì‚¬ KPI ë‹¬ì„±ë¥ ',data:kpiTrend,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,.15)',fill:true,tension:.4,pointRadius:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:CHART_DEFAULTS.color,font:{size:11}}}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:10}},grid:{color:CHART_DEFAULTS.grid}},y:{min:60,max:100,ticks:{color:CHART_DEFAULTS.color,font:{size:10}},grid:{color:CHART_DEFAULTS.grid}}}}});
  // Site profit chart
  destroyChart('dashSite');
  const siteNames=state.sites.map(s=>s.name.length>6?s.name.substring(0,6)+'..':s.name);
  const siteProfits=state.sites.map(s=>{const p=s.contract-s.exec;return+(p/s.contract*100).toFixed(1);});
  const siteColors=siteProfits.map(p=>p>10?'rgba(16,185,129,.8)':p>0?'rgba(245,158,11,.8)':'rgba(239,68,68,.8)');
  charts['dashSite']=new Chart(document.getElementById('dashSiteChart'),{type:'bar',data:{labels:siteNames,datasets:[{label:'ì´ìµë¥ (%)',data:siteProfits,backgroundColor:siteColors,borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:9}},grid:{color:CHART_DEFAULTS.grid}},y:{ticks:{color:CHART_DEFAULTS.color,font:{size:10}},grid:{color:CHART_DEFAULTS.grid}}}}});
  // Grade donut
  destroyChart('dashGrade');
  const grades={S:0,A:0,B:0,C:0,D:0};
  state.staff.forEach(e=>{if(grades[e.grade]!==undefined)grades[e.grade]++;});
  charts['dashGrade']=new Chart(document.getElementById('dashGradeChart'),{type:'doughnut',data:{labels:['Së“±ê¸‰','Aë“±ê¸‰','Bë“±ê¸‰','Cë“±ê¸‰','Dë“±ê¸‰'],datasets:[{data:Object.values(grades),backgroundColor:['#8b5cf6','#3b82f6','#10b981','#f59e0b','#ef4444'],borderWidth:0,hoverOffset:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:CHART_DEFAULTS.color,font:{size:11},padding:8}}}}});
  // Agent grid
  document.getElementById('agentGrid').innerHTML=AGENTS.map(a=>`
    <div class="agent-card">
      <div class="agent-dot ${a.status==='active'?'dot-active':'dot-idle'}"></div>
      <div class="agent-info"><div class="agent-name">${a.name}</div><div class="agent-status">${a.desc}</div></div>
    </div>`).join('');
  // Site summary table
  const tbody=document.querySelector('#dashSiteTable tbody');
  tbody.innerHTML=state.sites.map(s=>{
    const profit=s.contract-s.exec;
    const prate=+(profit/s.contract*100).toFixed(1);
    const sc={ì •ìƒ:'green',ì§€ì—°:'amber',ì´ˆê³¼:'red',ì‚¬ê³ :'red',ì™„ë£Œ:'blue'};
    return`<tr><td><strong>${s.name}</strong></td><td class="text-muted">${s.client}</td><td class="text-right">${s.contract}ì–µ</td><td class="text-right">${s.exec}ì–µ</td><td class="text-right ${profit>=0?'text-green':'text-red'}">${profit>=0?'+':''}${profit}ì–µ</td><td class="${prate>=10?'text-green':prate>=0?'text-amber':'text-red'}">${prate}%</td><td><div style="display:flex;align-items:center;gap:8px"><div class="progress-bar" style="flex:1"><div class="progress-fill fill-blue" style="width:${s.progress}%"></div></div><span style="font-size:11px;min-width:30px">${s.progress}%</span></div></td><td><span class="badge badge-${sc[s.status]||'gray'}">${s.status}</span></td></tr>`;
  }).join('');
}

// â”€â”€ 8. STAFF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStaffTable(){
  calcAllScores();
  const search=(document.getElementById('staffSearch')?.value||'').toLowerCase();
  const deptF=document.getElementById('staffDeptFilter')?.value||'';
  const rankF=document.getElementById('staffRankFilter')?.value||'';
  // Populate filters
  const deptSel=document.getElementById('staffDeptFilter');
  if(deptSel&&deptSel.options.length<=1){
    [...new Set(state.staff.map(e=>e.dept))].forEach(d=>{const o=document.createElement('option');o.value=d;o.textContent=d;deptSel.appendChild(o);});
  }
  const rankSel=document.getElementById('staffRankFilter');
  if(rankSel&&rankSel.options.length<=1){
    [...new Set(state.staff.map(e=>e.rank))].sort((a,b)=>(RANK_ORDER[a]??9)-(RANK_ORDER[b]??9)).forEach(r=>{const o=document.createElement('option');o.value=r;o.textContent=r;rankSel.appendChild(o);});
  }
  const filtered=state.staff.filter(e=>{
    if(search&&!e.name.includes(search))return false;
    if(deptF&&e.dept!==deptF)return false;
    if(rankF&&e.rank!==rankF)return false;
    return true;
  });
  document.getElementById('staffCountLabel').textContent=filtered.length;
  const tbody=document.getElementById('staffTableBody');
  tbody.innerHTML=filtered.map((e,i)=>{
    const kpi=calcKpiScore(e);
    return`<tr><td class="text-muted">${i+1}</td><td><strong>${e.name}</strong></td><td>${e.dept}</td><td>${e.rank}</td><td class="text-muted">${e.joined}</td><td class="text-muted">${e.site||'-'}</td><td class="text-blue fw-700">${kpi}</td><td>${e.competency}</td><td class="fw-700">${e.score}</td><td>${getGradeBadge(e.grade)}</td></tr>`;
  }).join('');
  if(!filtered.length)tbody.innerHTML='<tr><td colspan="10" style="text-align:center;padding:30px;color:var(--text3)">ì§ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. Excel íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ë°ëª¨ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”.</td></tr>';
}

// Excel Import
function dragOver(e){e.preventDefault();document.getElementById('uploadArea').classList.add('drag');}
function dropFile(e){e.preventDefault();document.getElementById('uploadArea').classList.remove('drag');const f=e.dataTransfer.files[0];if(f)processFile(f);}
function importExcel(inp){if(inp.files[0])processFile(inp.files[0]);}
function processFile(file){
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const wb=XLSX.read(e.target.result,{type:'binary'});
      const ws=wb.Sheets[wb.SheetNames[0]];
      const data=XLSX.utils.sheet_to_json(ws,{header:1});
      if(!data||data.length<2){alert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');return;}
      state.xlsxHeaders=data[0].map(String);
      state.xlsxRaw=data.slice(1).filter(r=>r.some(c=>c!=null&&c!==''));
      showColMap();
    }catch(err){alert('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: '+err.message);}
  };
  reader.readAsBinaryString(file);
}
function showColMap(){
  const card=document.getElementById('colMapCard');
  const body=document.getElementById('colMapBody');
  card.style.display='block';
  const fields=['ì´ë¦„','ë¶€ì„œ','ì§ê¸‰','ì…ì‚¬ì¼','í˜„ì¥'];
  const opts=`<option value="">-- ì„ íƒ --</option>`+state.xlsxHeaders.map(h=>`<option value="${h}">${h}</option>`).join('');
  body.innerHTML=`<div style="font-size:12px;color:var(--text3);margin-bottom:10px">ì—‘ì…€ì˜ ì»¬ëŸ¼ì„ ì‹œìŠ¤í…œ í•„ë“œì— ë§¤í•‘í•˜ì„¸ìš”</div>`+
    fields.map(f=>`<div class="form-group"><label class="form-label">${f}</label><select class="form-control" id="map_${f}">${opts}</select></div>`).join('');
  // Auto-detect
  const autoMap={ì´ë¦„:['ì´ë¦„','ì„±ëª…','name'],ë¶€ì„œ:['ë¶€ì„œ','ì†Œì†','ë¶€ì„œëª…','dept'],ì§ê¸‰:['ì§ê¸‰','ì§ìœ„','position','rank'],ì…ì‚¬ì¼:['ì…ì‚¬ì¼','ì…ì‚¬','joined'],í˜„ì¥:['í˜„ì¥','í˜„ì¥ëª…','site']};
  fields.forEach(f=>{
    const sel=document.getElementById('map_'+f);
    if(!sel)return;
    const candidates=autoMap[f]||[];
    const found=state.xlsxHeaders.find(h=>candidates.some(c=>h.toLowerCase().includes(c.toLowerCase())));
    if(found)sel.value=found;
  });
}
function applyMapping(){
  const fields=['ì´ë¦„','ë¶€ì„œ','ì§ê¸‰','ì…ì‚¬ì¼','í˜„ì¥'];
  const map={};
  fields.forEach(f=>{const sel=document.getElementById('map_'+f);if(sel)map[f]=sel.value;});
  if(!map['ì´ë¦„']){alert('ì´ë¦„ ì»¬ëŸ¼ì„ ë°˜ë“œì‹œ ì„ íƒí•˜ì„¸ìš”');return;}
  const newStaff=state.xlsxRaw.map((row,idx)=>{
    const get=(f)=>{const col=map[f];if(!col)return'';const i=state.xlsxHeaders.indexOf(col);return i>=0&&row[i]!=null?String(row[i]):''};
    const name=get('ì´ë¦„');if(!name)return null;
    const existing=state.staff.find(e=>e.name===name);
    if(existing)return existing;
    const defKpi={ëª©í‘œë‹¬ì„±:70,í’ˆì§ˆ:70,ì•ˆì „:70,í˜‘ì—…:70,ê¸°ì—¬:70};
    return{id:'ex'+Date.now()+idx,name,dept:get('ë¶€ì„œ')||'ë¯¸ë¶„ë¥˜',rank:get('ì§ê¸‰')||'ì‚¬ì›',joined:get('ì…ì‚¬ì¼')||'',site:get('í˜„ì¥')||'',kpi:defKpi,competency:70,peer:70,diligence:70,score:0,grade:''};
  }).filter(Boolean);
  state.staff=newStaff;
  calcAllScores();saveState();
  document.getElementById('colMapCard').style.display='none';
  document.getElementById('xlsxInput').value='';
  renderStaffTable();
  alert(`âœ… ${newStaff.length}ëª…ì˜ ì§ì› ë°ì´í„°ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!`);
}
function downloadSampleExcel(){
  const ws=XLSX.utils.aoa_to_sheet([['ì´ë¦„','ë¶€ì„œ','ì§ê¸‰','ì…ì‚¬ì¼','í˜„ì¥'],['í™ê¸¸ë™','ì¬ë¬´ê´€ë¦¬ì‹¤','ê³¼ì¥','2020-03-02',''],['ê¹€ì˜í¬','ê¸°ìˆ ì§€ì›ë³¸ë¶€','ëŒ€ë¦¬','2022-06-01','ì•„ì‚°íƒ•ì • í…Œí¬ë…¸ë°¸ë¦¬']]);
  const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'ì§ì›ëª©ë¡');
  XLSX.writeFile(wb,'ì„œì›í† ê±´_ì§ì›_ìƒ˜í”Œ.xlsx');
}

// â”€â”€ 9. SITE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSiteTable(){
  const search=(document.getElementById('siteSearch')?.value||'').toLowerCase();
  const statusF=document.getElementById('siteStatusFilter')?.value||'';
  const filtered=state.sites.filter(s=>{
    if(search&&!s.name.includes(search))return false;
    if(statusF&&!s.status.includes(statusF))return false;
    return true;
  });
  const tbody=document.getElementById('siteTableBody');
  tbody.innerHTML=filtered.map(s=>{
    const profit=+(s.contract-s.exec).toFixed(1);
    const prate=+(profit/s.contract*100).toFixed(1);
    const sc={ì •ìƒ:'green',ì§€ì—°:'amber',ì´ˆê³¼:'red',ì‚¬ê³ :'red',ì™„ë£Œ:'blue'};
    return`<tr>
      <td><strong>${s.name}</strong></td><td class="text-muted">${s.client}</td><td class="text-muted">${s.mgr||'-'}</td>
      <td class="text-right">${s.contract}ì–µ</td><td class="text-right">${s.exec}ì–µ</td>
      <td class="text-right ${profit>=0?'text-green':'text-red'}">${profit>=0?'+':''}${profit}ì–µ</td>
      <td class="${prate>=10?'text-green':prate>=0?'text-amber':'text-red'} fw-700">${prate}%</td>
      <td><div style="display:flex;align-items:center;gap:6px"><div class="progress-bar" style="flex:1"><div class="progress-fill fill-blue" style="width:${s.progress}%"></div></div><span style="font-size:11px">${s.progress}%</span></div></td>
      <td><span class="badge badge-${sc[s.status]||'gray'}">${s.status}</span></td>
      <td class="text-muted" style="font-size:11px">${s.period||'-'}</td>
      <td><div style="display:flex;gap:4px">
        <button class="btn btn-outline btn-sm" onclick="openSiteModal('${s.id}')">âœï¸</button>
        <button class="btn btn-danger btn-sm" onclick="deleteSite('${s.id}')">ğŸ—‘</button>
      </div></td>
    </tr>`;
  }).join('');
  if(!filtered.length)tbody.innerHTML='<tr><td colspan="11" style="text-align:center;padding:30px;color:var(--text3)">í˜„ì¥ ë°ì´í„° ì—†ìŒ</td></tr>';
  // Charts
  renderSiteCharts();
}
function renderSiteCharts(){
  destroyChart('siteBar');destroyChart('siteRev');
  const names=state.sites.map(s=>s.name.length>6?s.name.substring(0,6)+'..':s.name);
  const profits=state.sites.map(s=>+(((s.contract-s.exec)/s.contract)*100).toFixed(1));
  const colors=profits.map(p=>p>10?'rgba(16,185,129,.8)':p>0?'rgba(245,158,11,.8)':'rgba(239,68,68,.8)');
  charts['siteBar']=new Chart(document.getElementById('siteBarChart'),{type:'bar',data:{labels:names,datasets:[{label:'ì´ìµë¥ (%)',data:profits,backgroundColor:colors,borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:9}},grid:{color:CHART_DEFAULTS.grid}},y:{ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}}}}});
  const months=['25.10','25.11','25.12','26.01','26.02','26.03','26.04','26.05','26.06','26.07','26.08','26.09','26.10'];
  const totalRev=months.map((_,i)=>state.sites.reduce((a,s)=>a+(s.rev[i]||0),0));
  charts['siteRev']=new Chart(document.getElementById('siteRevenueChart'),{type:'line',data:{labels:months,datasets:[{label:'ì›”ë³„ ì´ë§¤ì¶œ(ì–µ)',data:totalRev,borderColor:'#06b6d4',backgroundColor:'rgba(6,182,212,.15)',fill:true,tension:.4,pointRadius:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:CHART_DEFAULTS.color,font:{size:11}}}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:10}},grid:{color:CHART_DEFAULTS.grid}},y:{ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}}}}});
}
function openSiteModal(id){
  const m=document.getElementById('siteModal');
  document.getElementById('mSiteId').value=id||'';
  document.getElementById('stampResult').style.display='none';
  if(id){
    const s=state.sites.find(x=>x.id===id);
    if(!s)return;
    document.getElementById('siteModalTitle').textContent='âœï¸ í˜„ì¥ ìˆ˜ì •: '+s.name;
    document.getElementById('mSiteName').value=s.name;
    document.getElementById('mSiteClient').value=s.client;
    document.getElementById('mSiteMgr').value=s.mgr||'';
    document.getElementById('mSiteLoc').value=s.loc||'';
    document.getElementById('mSiteContract').value=s.contract;
    document.getElementById('mSiteExec').value=s.exec;
    document.getElementById('mSitePeriod').value=s.period||'';
    document.getElementById('mSiteProgress').value=s.progress;
    document.getElementById('mSiteStatus').value=s.status;
    document.getElementById('mSiteSafety').value=s.safety||0;
    document.getElementById('mSiteNote').value=s.note||'';
    calcProfit();
  }else{
    document.getElementById('siteModalTitle').textContent='â• í˜„ì¥ ì¶”ê°€';
    ['mSiteName','mSiteClient','mSiteMgr','mSiteLoc','mSiteContract','mSiteExec','mSitePeriod','mSiteProgress','mSiteSafety','mSiteNote'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('mSiteStatus').value='ì •ìƒ';
    document.getElementById('mSiteProfit').value='';
    document.getElementById('mSiteProfitRate').value='';
  }
  m.classList.add('open');
}
function calcProfit(){
  const c=parseFloat(document.getElementById('mSiteContract').value)||0;
  const e=parseFloat(document.getElementById('mSiteExec').value)||0;
  const p=+(c-e).toFixed(1);
  const r=c>0?+(p/c*100).toFixed(1):0;
  document.getElementById('mSiteProfit').value=p+'ì–µ';
  document.getElementById('mSiteProfitRate').value=r+'%';
}
function saveSite(){
  const id=document.getElementById('mSiteId').value;
  const name=document.getElementById('mSiteName').value.trim();
  const client=document.getElementById('mSiteClient').value.trim();
  if(!name||!client){alert('í˜„ì¥ëª…ê³¼ ë°œì£¼ì²˜ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');return;}
  const data={
    name,client,
    mgr:document.getElementById('mSiteMgr').value.trim(),
    loc:document.getElementById('mSiteLoc').value.trim(),
    contract:parseFloat(document.getElementById('mSiteContract').value)||0,
    exec:parseFloat(document.getElementById('mSiteExec').value)||0,
    period:document.getElementById('mSitePeriod').value.trim(),
    progress:parseInt(document.getElementById('mSiteProgress').value)||0,
    status:document.getElementById('mSiteStatus').value,
    safety:parseInt(document.getElementById('mSiteSafety').value)||0,
    note:document.getElementById('mSiteNote').value.trim(),
  };
  if(id){
    const idx=state.sites.findIndex(s=>s.id===id);
    if(idx>=0)Object.assign(state.sites[idx],data);
  }else{
    const newId='s'+Date.now();
    state.sites.push({id:newId,...data,rev:Array(13).fill(0)});
  }
  saveState();closeModal('siteModal');renderSiteTable();
}
function deleteSite(id){
  if(!confirm('ì´ í˜„ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  state.sites=state.sites.filter(s=>s.id!==id);
  saveState();renderSiteTable();
}
function closeModal(id){document.getElementById(id).classList.remove('open');}

// â”€â”€ 10. KPI EVALUATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderKpiPage(){
  renderKpiStatus();
  // Populate evaluator name dropdown
  const rank=document.getElementById('evalRankSel').value;
  if(rank)loadEvalSubordinates();
}
function loadEvalSubordinates(){
  const rank=document.getElementById('evalRankSel').value;
  const nameSel=document.getElementById('evalNameSel');
  nameSel.innerHTML='<option value="">-- ì´ë¦„ ì„ íƒ --</option>';
  document.getElementById('evalTargetSel').innerHTML='<option value="">-- ì§ì› ì„ íƒ --</option>';
  document.getElementById('kpiInputBody').innerHTML='<div class="alert alert-info">í‰ê°€ ëŒ€ìƒ ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</div>';
  if(!rank)return;
  state.staff.filter(e=>e.rank===rank).forEach(e=>{
    const o=document.createElement('option');o.value=e.id;o.textContent=e.name+' ('+e.dept+')';nameSel.appendChild(o);
  });
}
function loadKpiTargets(){
  const rankSel=document.getElementById('evalRankSel').value;
  const targetSel=document.getElementById('evalTargetSel');
  targetSel.innerHTML='<option value="">-- ì§ì› ì„ íƒ --</option>';
  if(!rankSel)return;
  const myOrder=RANK_ORDER[rankSel]??99;
  // Show staff with rank one level below
  state.staff.filter(e=>{
    const eo=RANK_ORDER[e.rank]??99;
    return eo>myOrder&&eo<=myOrder+2;
  }).forEach(e=>{
    const o=document.createElement('option');o.value=e.id;o.textContent=e.name+' ('+e.rank+', '+e.dept+')';targetSel.appendChild(o);
  });
}
// Override: when evalNameSel changes, load targets
document.addEventListener('DOMContentLoaded',()=>{
  const ns=document.getElementById('evalNameSel');
  if(ns)ns.addEventListener('change',loadKpiTargets);
});
function loadKpiInputs(){
  const tid=document.getElementById('evalTargetSel').value;
  const card=document.getElementById('kpiInputBody');
  if(!tid){card.innerHTML='<div class="alert alert-info">í‰ê°€ ëŒ€ìƒ ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</div>';return;}
  const emp=state.staff.find(e=>e.id===tid);
  if(!emp){card.innerHTML='<div class="alert alert-warn">ì§ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';return;}
  const items=['ëª©í‘œë‹¬ì„±','í’ˆì§ˆ','ì•ˆì „','í˜‘ì—…','ê¸°ì—¬'];
  card.innerHTML=`<div style="margin-bottom:12px"><strong>${emp.name}</strong> <span class="text-muted">(${emp.rank}, ${emp.dept})</span></div>`+
    items.map(item=>`
      <div class="kpi-slider-wrap">
        <div class="kpi-slider-header">
          <span class="kpi-slider-label">${item==='ëª©í‘œë‹¬ì„±'?'ğŸ¯':item==='í’ˆì§ˆ'?'â­':item==='ì•ˆì „'?'ğŸ¦º':item==='í˜‘ì—…'?'ğŸ¤':'ğŸ’¡'} ${item}</span>
          <span class="kpi-slider-value" id="kv_${item}">${emp.kpi[item]||70}</span>
        </div>
        <input type="range" min="0" max="100" value="${emp.kpi[item]||70}" id="ks_${item}" oninput="document.getElementById('kv_${item}').textContent=this.value;calcKpiLive()">
      </div>`).join('')+
    `<div style="background:var(--surface2);border-radius:8px;padding:12px;text-align:center;margin:12px 0">
      <div style="font-size:12px;color:var(--text3)">KPI í•©ê³„</div>
      <div style="font-size:28px;font-weight:700;color:var(--blue)" id="kpiLiveScore">0</div>
    </div>
    <button class="btn btn-primary" style="width:100%" onclick="saveKpiInputs('${emp.id}')">ğŸ’¾ KPI ì €ì¥</button>`;
  calcKpiLive();
}
function calcKpiLive(){
  const items=['ëª©í‘œë‹¬ì„±','í’ˆì§ˆ','ì•ˆì „','í˜‘ì—…','ê¸°ì—¬'];
  const sum=items.reduce((a,item)=>{const el=document.getElementById('ks_'+item);return a+(el?parseInt(el.value):0);},0);
  const avg=Math.round(sum/items.length);
  const el=document.getElementById('kpiLiveScore');
  if(el)el.textContent=avg;
}
function saveKpiInputs(eid){
  const emp=state.staff.find(e=>e.id===eid);if(!emp)return;
  const items=['ëª©í‘œë‹¬ì„±','í’ˆì§ˆ','ì•ˆì „','í˜‘ì—…','ê¸°ì—¬'];
  items.forEach(item=>{const el=document.getElementById('ks_'+item);if(el)emp.kpi[item]=parseInt(el.value);});
  calcAllScores();saveState();
  renderKpiStatus();
  alert('âœ… '+emp.name+'ì˜ KPIê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}
function renderKpiStatus(){
  calcAllScores();
  const tbody=document.getElementById('kpiStatusBody');
  tbody.innerHTML=state.staff.map(e=>{
    const k=e.kpi;const total=calcKpiScore(e);const done=Object.values(k).some(v=>v!==70);
    return`<tr><td><strong>${e.name}</strong></td><td>${e.dept}</td><td>${e.rank}</td><td>${k.ëª©í‘œë‹¬ì„±}</td><td>${k.í’ˆì§ˆ}</td><td>${k.ì•ˆì „}</td><td>${k.í˜‘ì—…}</td><td>${k.ê¸°ì—¬}</td><td class="fw-700 text-blue">${total}</td><td><span class="badge badge-${done?'green':'gray'}">${done?'ì…ë ¥ì™„ë£Œ':'ë¯¸ì…ë ¥'}</span></td></tr>`;
  }).join('');
}

// â”€â”€ 11. MULTI EVALUATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMultiPage(){
  const pSel=document.getElementById('peerEvalSel');
  const tSel=document.getElementById('peerTargetSel');
  if(pSel.options.length<=1){
    state.staff.forEach(e=>{const o=document.createElement('option');o.value=e.id;o.textContent=e.name+' ('+e.dept+')';pSel.appendChild(o);});
  }
  if(tSel.options.length<=1){
    state.staff.forEach(e=>{const o=document.createElement('option');o.value=e.id;o.textContent=e.name+' ('+e.dept+')';tSel.appendChild(o);});
  }
  renderMultiStatus();
  renderMultiRadar(null);
}
function renderMultiRadar(emp){
  destroyChart('multiRadar');
  const data=emp?[emp.competency,calcKpiScore(emp),emp.peer,emp.diligence,Math.round(Object.values(emp.kpi).reduce((a,b)=>a+b,0)/5),emp.score]:[60,65,70,68,62,66];
  const labels=['ì—­ëŸ‰','KPI','ë™ë£Œí‰ê°€','ì„±ì‹¤ë„','ì§ë¬´ì „ë¬¸ì„±','ì¢…í•©ì ìˆ˜'];
  charts['multiRadar']=new Chart(document.getElementById('multiRadarChart'),{type:'radar',data:{labels,datasets:[{label:emp?emp.name:'ìƒ˜í”Œ',data,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,.2)',pointBackgroundColor:'#3b82f6',pointRadius:4}]},options:{responsive:true,maintainAspectRatio:false,scales:{r:{min:0,max:100,ticks:{color:CHART_DEFAULTS.color,font:{size:9},backdropColor:'transparent'},grid:{color:CHART_DEFAULTS.grid},pointLabels:{color:CHART_DEFAULTS.color,font:{size:11}}}},plugins:{legend:{labels:{color:CHART_DEFAULTS.color}}}}});
}
function savePeerEval(){
  const tid=document.getElementById('peerTargetSel').value;
  const emp=state.staff.find(e=>e.id===tid);
  if(!emp){alert('í‰ê°€ ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”');return;}
  const avg=Math.round((parseInt(document.getElementById('sPeer1').value)+parseInt(document.getElementById('sPeer2').value)+parseInt(document.getElementById('sPeer3').value)+parseInt(document.getElementById('sPeer4').value))/4);
  emp.peer=avg;emp.competency=Math.round((emp.competency+avg)/2);
  calcAllScores();saveState();renderMultiStatus();renderMultiRadar(emp);
  document.getElementById('multiTargetName').innerHTML=`<span style="color:var(--blue);font-weight:600">${emp.name}</span>ì˜ ì—­ëŸ‰ ì°¨íŠ¸`;
  alert('âœ… ë™ë£Œ í‰ê°€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}
function renderMultiStatus(){
  const tbody=document.getElementById('multiStatusBody');
  tbody.innerHTML=state.staff.map(e=>`<tr><td><strong>${e.name}</strong></td><td>${e.dept}</td><td>${e.rank}</td><td>${e.competency}</td><td>${e.peer}</td><td>${Math.round(e.competency*0.7+e.peer*0.3)}</td><td>${e.diligence}</td><td class="fw-700 text-blue">${Math.round((e.competency+e.peer+e.diligence)/3)}</td><td><span class="badge badge-green">ì™„ë£Œ</span></td></tr>`).join('');
}

// â”€â”€ 12. FAIRNESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFairPage(){
  calcAllScores();
  const avg=state.staff.reduce((a,e)=>a+e.score,0)/state.staff.length;
  const std=Math.sqrt(state.staff.reduce((a,e)=>a+(e.score-avg)**2,0)/state.staff.length);
  const biasCount=state.staff.filter(e=>Math.abs((e.score-avg)/std)>2).length;
  const fairIdx=Math.round((1-biasCount/state.staff.length)*100*10)/10;
  document.getElementById('fairStats').innerHTML=`
    <div class="stat-card stat-blue"><div class="stat-label">ê³µì •ì„± ì§€ìˆ˜</div><div class="stat-value">${fairIdx}%</div><div class="stat-sub">ëª©í‘œ 90% ì´ìƒ</div></div>
    <div class="stat-card stat-green"><div class="stat-label">ì „ì‚¬ í‰ê· </div><div class="stat-value">${Math.round(avg)}ì </div><div class="stat-sub">í‘œì¤€í¸ì°¨ ${Math.round(std)}ì </div></div>
    <div class="stat-card stat-amber"><div class="stat-label">í¸í–¥ ì˜ì‹¬ ê±´</div><div class="stat-value">${biasCount}ê±´</div><div class="stat-sub">Z>2 ê¸°ì¤€</div></div>
    <div class="stat-card stat-blue"><div class="stat-label">ìº˜ë¦¬ë¸Œë ˆì´ì…˜</div><div class="stat-value">ì™„ë£Œ</div><div class="stat-sub">11ì›” ë°˜ì˜</div></div>`;
  // Z-Score chart
  destroyChart('fairZ');
  const sorted=[...state.staff].sort((a,b)=>a.score-b.score);
  const zscores=sorted.map(e=>+((e.score-avg)/std).toFixed(2));
  const zColors=zscores.map(z=>Math.abs(z)>2?'rgba(239,68,68,.8)':Math.abs(z)>1?'rgba(245,158,11,.8)':'rgba(59,130,246,.8)');
  charts['fairZ']=new Chart(document.getElementById('fairZChart'),{type:'bar',data:{labels:sorted.map(e=>e.name),datasets:[{label:'Z-Score',data:zscores,backgroundColor:zColors,borderRadius:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:8}},grid:{color:CHART_DEFAULTS.grid}},y:{ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}}}}});
  // Dept avg chart
  destroyChart('fairDept');
  const deptAvg=DEPTS.map(d=>{const members=state.staff.filter(e=>e.dept===d);return members.length?Math.round(members.reduce((a,e)=>a+e.score,0)/members.length):0;});
  charts['fairDept']=new Chart(document.getElementById('fairDeptChart'),{type:'bar',data:{labels:DEPTS.map(d=>d.length>5?d.substring(0,5)+'..':d),datasets:[{label:'ë¶€ì„œ í‰ê· ',data:deptAvg,backgroundColor:chartColors(DEPTS.length).map(c=>c+'cc'),borderRadius:4},{label:'ì „ì‚¬ í‰ê· ',data:DEPTS.map(()=>Math.round(avg)),borderColor:'#ef4444',borderWidth:2,borderDash:[4,4],type:'line',pointRadius:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:CHART_DEFAULTS.color,font:{size:11}}}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:9}},grid:{color:CHART_DEFAULTS.grid}},y:{min:50,max:100,ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}}}}});
  // Alerts
  const alerts=[];
  if(biasCount>0)alerts.push({type:'warn',msg:`âš ï¸ Z-Score 2 ì´ˆê³¼ ì§ì› ${biasCount}ëª… ë°œê²¬ â€” ì¬ê²€í†  ê¶Œì¥`});
  const deptDiff=Math.max(...deptAvg)-Math.min(...deptAvg.filter(v=>v>0));
  if(deptDiff>15)alerts.push({type:'warn',msg:`âš ï¸ ë¶€ì„œ ê°„ í‰ê·  ì ìˆ˜ í¸ì°¨ ${Math.round(deptDiff)}ì  â€” ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í•„ìš”`});
  alerts.push({type:'ok',msg:'âœ… ì§ê¸‰ë³„ ì ìˆ˜ ë¶„í¬ ì •ìƒ ë²”ìœ„ ë‚´'});
  alerts.push({type:'ok',msg:'âœ… NLP í¸í–¥ ë¶„ì„: í‰ê°€ ì½”ë©˜íŠ¸ ë‚´ ì°¨ë³„ í‘œí˜„ ë¯¸ê²€ì¶œ'});
  document.getElementById('fairAlerts').innerHTML=alerts.map(a=>`<div class="alert ${a.type==='warn'?'alert-warn':'alert-success'}" style="margin-bottom:8px">${a.msg}</div>`).join('');
}

// â”€â”€ 13. REWARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRewardPage(){calcReward();}
function calcReward(){
  calcAllScores();
  const sorted=[...state.staff].sort((a,b)=>b.score-a.score);
  const tbody=document.getElementById('rewardTableBody');
  tbody.innerHTML=sorted.map((e,i)=>`<tr><td class="fw-700 text-muted">${i+1}</td><td><strong>${e.name}</strong></td><td>${e.dept}</td><td>${e.rank}</td><td>${calcKpiScore(e)}</td><td>${e.competency}</td><td>${e.peer}</td><td>${e.diligence}</td><td class="fw-700 text-blue">${e.score}</td><td>${getGradeBadge(e.grade)}</td></tr>`).join('');
  // Donut
  destroyChart('rewardDonut');
  const grades={S:0,A:0,B:0,C:0,D:0};
  state.staff.forEach(e=>{if(grades[e.grade]!==undefined)grades[e.grade]++;});
  charts['rewardDonut']=new Chart(document.getElementById('rewardDonut'),{type:'doughnut',data:{labels:['S','A','B','C','D'],datasets:[{data:Object.values(grades),backgroundColor:['#8b5cf6','#3b82f6','#10b981','#f59e0b','#ef4444'],borderWidth:0,hoverOffset:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:CHART_DEFAULTS.color,font:{size:11},padding:8}}}}});
  const colors={S:'purple',A:'blue',B:'green',C:'amber',D:'red'};
  document.getElementById('rewardGradeSummary').innerHTML=Object.entries(grades).map(([g,c])=>`<span class="badge badge-${colors[g]}">${g}: ${c}ëª…</span>`).join('');
}
function approveReward(){
  document.getElementById('stampTitle').textContent='ğŸ’° ë³´ìƒ ë“±ê¸‰ ìµœì¢… ìŠ¹ì¸';
  document.getElementById('stampDesc').textContent='2026ë…„ë„ ì „ì§ì› ë³´ìƒ ë“±ê¸‰ì„ ìµœì¢… ìŠ¹ì¸í•©ë‹ˆë‹¤';
  document.getElementById('stampResult').style.display='none';
  document.getElementById('stampModal').classList.add('open');
}

// â”€â”€ 14. AWARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcAwards(){
  calcAllScores();
  const sorted=[...state.staff].sort((a,b)=>b.score-a.score);
  const top3=sorted.slice(0,3);
  // Best site by profit rate
  const sitesWithRate=state.sites.map(s=>({...s,prate:+(((s.contract-s.exec)/s.contract)*100).toFixed(1)}));
  const bestSite=sitesWithRate.sort((a,b)=>b.prate-a.prate)[0];
  const safeSite=[...state.sites].sort((a,b)=>b.safety-a.safety)[0];
  const bestDept=DEPTS.map(d=>{const members=state.staff.filter(e=>e.dept===d);return{dept:d,avg:members.length?Math.round(members.reduce((a,e)=>a+e.score,0)/members.length):0};}).sort((a,b)=>b.avg-a.avg)[0];
  // Special: highest KPI contribution score
  const specialEmp=[...state.staff].sort((a,b)=>b.kpi['ê¸°ì—¬']-a.kpi['ê¸°ì—¬'])[0];
  const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  const standH=['stand-1','stand-2','stand-3'];
  const avatarC=['avatar-gold','avatar-silver','avatar-bronze'];
  const podiumOrder=[top3[1],top3[0],top3[2]].filter(Boolean);
  const html=`
    <div class="award-section">
      <div class="award-section-title">ğŸ¥‡ ìµœìš°ìˆ˜ì‚¬ì› TOP 3</div>
      <div class="podium">
        ${podiumOrder.map((e,pi)=>{
          const origRank=top3.indexOf(e);
          return`<div class="podium-block">
            <div class="podium-avatar ${avatarC[origRank]}" style="font-size:18px">${e.name.charAt(0)}</div>
            <div class="podium-name">${e.name}</div>
            <div class="podium-dept">${e.dept} Â· ${e.rank}</div>
            <div class="podium-score">${e.score}ì </div>
            <div class="podium-stand ${standH[pi]==='stand-1'?'stand-2':pi===1?'stand-1':'stand-3'}">${pi===1?'ğŸ¥‡':pi===0?'ğŸ¥ˆ':'ğŸ¥‰'}</div>
          </div>`;
        }).join('')}
      </div>
      <div class="award-cards">
        ${top3.map((e,i)=>`<div class="award-card ${i===0?'gold':i===1?'silver':'bronze'}">
          <div class="award-emoji">${medals[i]}</div>
          <div class="award-name">${e.name}</div>
          <div class="award-dept">${e.dept} Â· ${e.rank}</div>
          <div class="award-score">${e.score}ì </div>
          <div class="score-breakdown">
            <div class="score-item">KPI <span>${calcKpiScore(e)}</span></div>
            <div class="score-item">ì—­ëŸ‰ <span>${e.competency}</span></div>
            <div class="score-item">ë™ë£Œ <span>${e.peer}</span></div>
          </div>
        </div>`).join('')}
      </div>
    </div>
    <div class="grid-2">
      <div class="award-section">
        <div class="award-section-title">ğŸ— ìµœìš°ìˆ˜í˜„ì¥</div>
        <div class="award-card gold">
          <div class="award-emoji">ğŸ—</div>
          <div class="award-name">${bestSite.name}</div>
          <div class="award-dept">ë°œì£¼ì²˜: ${bestSite.client}</div>
          <div class="award-score">ì´ìµë¥  ${bestSite.prate}%</div>
          <div class="score-breakdown">
            <div class="score-item">ë„ê¸‰ <span>${bestSite.contract}ì–µ</span></div>
            <div class="score-item">ì´ìµ <span>${+(bestSite.contract-bestSite.exec).toFixed(1)}ì–µ</span></div>
            <div class="score-item">ê³µì • <span>${bestSite.progress}%</span></div>
          </div>
        </div>
      </div>
      <div class="award-section">
        <div class="award-section-title">ğŸ¦º ì•ˆì „ìš°ìˆ˜ìƒ</div>
        <div class="award-card">
          <div class="award-emoji">ğŸ¦º</div>
          <div class="award-name">${safeSite.name}</div>
          <div class="award-dept">ì•ˆì „ì ìˆ˜ ${safeSite.safety}ì </div>
          <div class="award-score" style="color:var(--green)">${safeSite.safety}ì </div>
          <div class="score-breakdown"><div class="score-item">í˜„í™© <span>${safeSite.status}</span></div></div>
        </div>
      </div>
      <div class="award-section">
        <div class="award-section-title">â­ í’ˆì§ˆìš°ìˆ˜ìƒ</div>
        <div class="award-card">
          <div class="award-emoji">â­</div>
          <div class="award-name">${bestDept.dept}</div>
          <div class="award-dept">ë¶€ì„œ í‰ê·  ${bestDept.avg}ì </div>
          <div class="award-score" style="color:var(--amber)">${bestDept.avg}ì </div>
        </div>
      </div>
      <div class="award-section">
        <div class="award-section-title">ğŸŒŸ íŠ¹ë³„ê³µë¡œìƒ</div>
        <div class="award-card">
          <div class="award-emoji">ğŸŒŸ</div>
          <div class="award-name">${specialEmp.name}</div>
          <div class="award-dept">${specialEmp.dept} Â· ${specialEmp.rank}</div>
          <div class="award-score" style="color:var(--purple)">${specialEmp.kpi['ê¸°ì—¬']}ì </div>
          <div class="score-breakdown"><div class="score-item">ê¸°ì—¬ë„ <span>${specialEmp.kpi['ê¸°ì—¬']}</span></div></div>
        </div>
      </div>
    </div>
    <div style="margin-top:20px">
      <button class="btn btn-gold" style="width:100%;padding:14px" onclick="approveAwards()">ğŸ” ëŒ€í‘œì´ì‚¬ ê²°ì¬</button>
    </div>`;
  document.getElementById('awardsBody').innerHTML=html;
}
function approveAwards(){
  document.getElementById('stampTitle').textContent='ğŸ† ì—°ë§ ì‹œìƒì‹ ìµœì¢… ìŠ¹ì¸';
  document.getElementById('stampDesc').textContent='2026ë…„ë„ ì„œì›í† ê±´ ì—°ë§ ì‹œìƒì‹ ìˆ˜ìƒìë¥¼ ìµœì¢… ê²°ì¬í•©ë‹ˆë‹¤';
  document.getElementById('stampResult').style.display='none';
  document.getElementById('stampModal').classList.add('open');
}
function approveAll(){
  document.getElementById('stampTitle').textContent='ğŸ” 2026 ì¸ì‚¬ê³ ê³¼ ìµœì¢… ìŠ¹ì¸';
  document.getElementById('stampDesc').textContent='2026ë…„ë„ ì„œì›í† ê±´ ì „ì§ì› ì¸ì‚¬ê³ ê³¼ ê²°ê³¼ë¥¼ ìµœì¢… ìŠ¹ì¸í•©ë‹ˆë‹¤';
  document.getElementById('stampResult').style.display='none';
  document.getElementById('stampModal').classList.add('open');
}
function execStamp(){
  const btn=document.getElementById('stampExecBtn');
  btn.textContent='ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘...';btn.disabled=true;
  setTimeout(()=>{
    document.getElementById('stampResult').style.display='block';
    btn.textContent='âœ… ìŠ¹ì¸ ì™„ë£Œ';
    btn.classList.add('stamp-approved');
  },1200);
}

// â”€â”€ 15. APPEAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAppealPage(){
  const sel=document.getElementById('appealStaffSel');
  if(sel.options.length<=1){
    state.staff.forEach(e=>{const o=document.createElement('option');o.value=e.id;o.textContent=e.name+' ('+e.dept+')';sel.appendChild(o);});
  }
  const list=document.getElementById('appealList');
  const stColors={ê²€í† ì¤‘:'amber',ì ‘ìˆ˜:'blue',ì™„ë£Œ:'green',ê¸°ê°:'red'};
  list.innerHTML=state.appeals.length?state.appeals.map(a=>`<div style="padding:12px;border:1px solid var(--border);border-radius:8px;margin-bottom:10px">
    <div class="flex-between"><strong>${a.name}</strong><span class="badge badge-${stColors[a.status]||'gray'}">${a.status}</span></div>
    <div style="font-size:11px;color:var(--text3);margin-top:4px">${a.dept} Â· ${a.type} Â· ${a.date}</div>
    <div style="font-size:12px;margin-top:8px;color:var(--text2)">${a.content}</div>
  </div>`).join(''):'<div class="text-muted" style="padding:20px;text-align:center">ì´ì˜ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
  document.getElementById('appealBadge').textContent=state.appeals.filter(a=>a.status==='ì ‘ìˆ˜'||a.status==='ê²€í† ì¤‘').length||'';
}
function submitAppeal(){
  const sid=document.getElementById('appealStaffSel').value;
  const emp=state.staff.find(e=>e.id===sid);
  if(!emp){alert('ì‹ ì²­ìë¥¼ ì„ íƒí•˜ì„¸ìš”');return;}
  const content=document.getElementById('appealContent').value.trim();
  if(!content){alert('ì‹ ì²­ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”');return;}
  const type=document.getElementById('appealType').value;
  const today=new Date().toISOString().split('T')[0];
  state.appeals.push({id:'ap'+Date.now(),name:emp.name,dept:emp.dept,type,content,status:'ì ‘ìˆ˜',date:today});
  saveState();
  document.getElementById('appealContent').value='';
  document.getElementById('appealStaffSel').value='';
  renderAppealPage();
  alert('âœ… ì´ì˜ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤');
}

// â”€â”€ 16. REPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReportPage(){
  calcAllScores();
  const avg=Math.round(state.staff.reduce((a,e)=>a+e.score,0)/state.staff.length);
  const aGrade=state.staff.filter(e=>e.grade==='A'||e.grade==='S').length;
  const totalRev=state.sites.reduce((a,s)=>a+s.contract,0);
  const totalProfit=state.sites.reduce((a,s)=>a+(s.contract-s.exec),0);
  document.getElementById('reportStats').innerHTML=`
    <div class="stat-card stat-blue"><div class="stat-label">ì „ì‚¬ í‰ê·  ì ìˆ˜</div><div class="stat-value">${avg}ì </div></div>
    <div class="stat-card stat-green"><div class="stat-label">S/A ë“±ê¸‰ ë¹„ìœ¨</div><div class="stat-value">${Math.round(aGrade/state.staff.length*100)}%</div></div>
    <div class="stat-card stat-amber"><div class="stat-label">ì´ ë„ê¸‰ê¸ˆì•¡</div><div class="stat-value">${totalRev}ì–µ</div></div>
    <div class="stat-card stat-${totalProfit>0?'green':'red'}"><div class="stat-label">ì´ ì´ìµê¸ˆ</div><div class="stat-value">${totalProfit}ì–µ</div></div>`;
  // Dept KPI chart
  destroyChart('reportDeptKpi');
  const deptAvg=DEPTS.map(d=>{const m=state.staff.filter(e=>e.dept===d);return m.length?Math.round(m.reduce((a,e)=>a+calcKpiScore(e),0)/m.length):0;});
  charts['reportDeptKpi']=new Chart(document.getElementById('reportDeptKpi'),{type:'bar',data:{labels:DEPTS.map(d=>d.length>5?d.substring(0,5)+'..':d),datasets:[{label:'ë¶€ì„œ KPI í‰ê· ',data:deptAvg,backgroundColor:chartColors(DEPTS.length).map(c=>c+'cc'),borderRadius:5}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:9}},grid:{color:CHART_DEFAULTS.grid}},y:{min:60,max:100,ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}}}}});
  // Site perf chart
  destroyChart('reportSitePerf');
  const sorted=[...state.sites].sort((a,b)=>b.progress-a.progress);
  charts['reportSitePerf']=new Chart(document.getElementById('reportSitePerf'),{type:'bar',data:{labels:sorted.map(s=>s.name.length>7?s.name.substring(0,7)+'..':s.name),datasets:[{label:'ê³µì •ë¥ (%)',data:sorted.map(s=>s.progress),backgroundColor:sorted.map(s=>s.progress>=80?'rgba(16,185,129,.8)':s.progress>=50?'rgba(245,158,11,.8)':'rgba(239,68,68,.8)'),borderRadius:5}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:CHART_DEFAULTS.color,font:{size:9}},grid:{color:CHART_DEFAULTS.grid}},y:{min:0,max:100,ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}}}}});
  // Rank chart
  destroyChart('reportRank');
  const rankAvg=RANKS.map(r=>{const m=state.staff.filter(e=>e.rank===r);return m.length?Math.round(m.reduce((a,e)=>a+e.score,0)/m.length):0;});
  charts['reportRank']=new Chart(document.getElementById('reportRankChart'),{type:'line',data:{labels:RANKS,datasets:[{label:'ì§ê¸‰ë³„ í‰ê·  ì ìˆ˜',data:rankAvg,borderColor:'#8b5cf6',backgroundColor:'rgba(139,92,246,.15)',fill:true,tension:.4,pointRadius:5,pointBackgroundColor:'#8b5cf6'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:CHART_DEFAULTS.color}}},scales:{x:{ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}},y:{min:60,max:100,ticks:{color:CHART_DEFAULTS.color},grid:{color:CHART_DEFAULTS.grid}}}}});
}

// â”€â”€ 17. SETTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSettingPage(){
  const deptList=document.getElementById('deptList');
  deptList.innerHTML=DEPTS.map(d=>`<span class="badge badge-blue" style="padding:5px 10px">${d}</span>`).join('');
}
function exportAllData(){
  const data={staff:state.staff,sites:state.sites,appeals:state.appeals,exported:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='sframe_data_'+new Date().toISOString().split('T')[0]+'.json';a.click();
}
function resetToDemo(){
  if(!confirm('ë°ëª¨ ë°ì´í„°ë¡œ ì´ˆê¸°í™”í•©ë‹ˆê¹Œ? í˜„ì¬ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.'))return;
  state.sites=JSON.parse(JSON.stringify(DEMO_SITES));
  state.staff=JSON.parse(JSON.stringify(DEMO_STAFF));
  state.appeals=JSON.parse(JSON.stringify(APPEALS));
  calcAllScores();saveState();
  location.reload();
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded',()=>{
  loadState();
  updateClock();setInterval(updateClock,1000);
  renderDashboard();
  // Close sidebar on overlay click
  document.addEventListener('click',(e)=>{
    const sb=document.getElementById('sidebar');
    if(sb.classList.contains('open')&&!sb.contains(e.target)&&!e.target.classList.contains('hamburger')){
      sb.classList.remove('open');
    }
  });
  // Close modal on overlay click
  document.querySelectorAll('.modal-overlay').forEach(mo=>{
    mo.addEventListener('click',(e)=>{if(e.target===mo)mo.classList.remove('open');});
  });
  // evalNameSel change handler
  const ns=document.getElementById('evalNameSel');
  if(ns)ns.addEventListener('change',loadKpiTargets);
});
</script>
</body>
</html>
